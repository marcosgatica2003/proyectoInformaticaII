\doxysection{MFRC522.\+cpp}
\hypertarget{MFRC522_8cpp_source}{}\label{MFRC522_8cpp_source}\index{main/libraries/RFID-\/RC522/MFRC522.cpp@{main/libraries/RFID-\/RC522/MFRC522.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{*\ MFRC522.cpp\ -\/\ Library\ to\ use\ ARDUINO\ RFID\ MODULE\ KIT\ 13.56\ MHZ\ WITH\ TAGS\ SPI\ W\ AND\ R\ BY\ COOQROBOT.}}
\DoxyCodeLine{00003\ \textcolor{comment}{*\ NOTE:\ Please\ also\ check\ the\ comments\ in\ MFRC522.h\ -\/\ they\ provide\ useful\ hints\ and\ background\ information.}}
\DoxyCodeLine{00004\ \textcolor{comment}{*\ Released\ into\ the\ public\ domain.}}
\DoxyCodeLine{00005\ \textcolor{comment}{*/}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}MFRC522.h"{}}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Functions\ for\ setting\ up\ the\ Arduino}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00016\ \mbox{\hyperlink{classMFRC522_a999d0301e800f479e1ecfa2fd06e28c8}{MFRC522::MFRC522}}():\ \mbox{\hyperlink{classMFRC522}{MFRC522}}(SS,\ UINT8\_MAX)\ \{\ \textcolor{comment}{//\ SS\ is\ defined\ in\ pins\_arduino.h,\ UINT8\_MAX\ means\ there\ is\ no\ connection\ from\ Arduino\ to\ MFRC522's\ reset\ and\ power\ down\ input}}
\DoxyCodeLine{00017\ \}\ \textcolor{comment}{//\ End\ constructor}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00023\ \mbox{\hyperlink{classMFRC522_a999d0301e800f479e1ecfa2fd06e28c8}{MFRC522::MFRC522}}(\ \ \ \textcolor{keywordtype}{byte}\ resetPowerDownPin\ \ }
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ):\ \mbox{\hyperlink{classMFRC522}{MFRC522}}(SS,\ resetPowerDownPin)\ \{\ \textcolor{comment}{//\ SS\ is\ defined\ in\ pins\_arduino.h}}
\DoxyCodeLine{00025\ \}\ \textcolor{comment}{//\ End\ constructor}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00031\ \mbox{\hyperlink{classMFRC522_a999d0301e800f479e1ecfa2fd06e28c8}{MFRC522::MFRC522}}(\ \ \ \textcolor{keywordtype}{byte}\ chipSelectPin,\ \ \ \ \ }
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ resetPowerDownPin\ \ }
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \_chipSelectPin\ =\ chipSelectPin;}
\DoxyCodeLine{00035\ \ \ \ \ \_resetPowerDownPin\ =\ resetPowerDownPin;}
\DoxyCodeLine{00036\ \}\ \textcolor{comment}{//\ End\ constructor}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00039\ \textcolor{comment}{//\ Basic\ interface\ functions\ for\ communicating\ with\ the\ MFRC522}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00046\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{MFRC522::PCD\_WriteRegister}}(\ \ PCD\_Register\ reg,\ \ \ }
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ value\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00049\ \ \ \ \ SPI.beginTransaction(SPISettings(MFRC522\_SPICLOCK,\ MSBFIRST,\ SPI\_MODE0));\ \ \ \textcolor{comment}{//\ Set\ the\ settings\ to\ work\ with\ SPI\ bus}}
\DoxyCodeLine{00050\ \ \ \ \ digitalWrite(\_chipSelectPin,\ LOW);\ \ \ \ \ \ \textcolor{comment}{//\ Select\ slave}}
\DoxyCodeLine{00051\ \ \ \ \ SPI.transfer(reg);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ MSB\ ==\ 0\ is\ for\ writing.\ LSB\ is\ not\ used\ in\ address.\ Datasheet\ section\ 8.1.2.3.}}
\DoxyCodeLine{00052\ \ \ \ \ SPI.transfer(value);}
\DoxyCodeLine{00053\ \ \ \ \ digitalWrite(\_chipSelectPin,\ HIGH);\ \ \ \ \ \textcolor{comment}{//\ Release\ slave\ again}}
\DoxyCodeLine{00054\ \ \ \ \ SPI.endTransaction();\ \textcolor{comment}{//\ Stop\ using\ the\ SPI\ bus}}
\DoxyCodeLine{00055\ \}\ \textcolor{comment}{//\ End\ PCD\_WriteRegister()}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00061\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{MFRC522::PCD\_WriteRegister}}(\ \ PCD\_Register\ reg,\ \ \ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ count,\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *values\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00065\ \ \ \ \ SPI.beginTransaction(SPISettings(MFRC522\_SPICLOCK,\ MSBFIRST,\ SPI\_MODE0));\ \ \ \textcolor{comment}{//\ Set\ the\ settings\ to\ work\ with\ SPI\ bus}}
\DoxyCodeLine{00066\ \ \ \ \ digitalWrite(\_chipSelectPin,\ LOW);\ \ \ \ \ \ \textcolor{comment}{//\ Select\ slave}}
\DoxyCodeLine{00067\ \ \ \ \ SPI.transfer(reg);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ MSB\ ==\ 0\ is\ for\ writing.\ LSB\ is\ not\ used\ in\ address.\ Datasheet\ section\ 8.1.2.3.}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ index\ =\ 0;\ index\ <\ count;\ index++)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ SPI.transfer(values[index]);}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ \ \ \ \ digitalWrite(\_chipSelectPin,\ HIGH);\ \ \ \ \ \textcolor{comment}{//\ Release\ slave\ again}}
\DoxyCodeLine{00072\ \ \ \ \ SPI.endTransaction();\ \textcolor{comment}{//\ Stop\ using\ the\ SPI\ bus}}
\DoxyCodeLine{00073\ \}\ \textcolor{comment}{//\ End\ PCD\_WriteRegister()}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00079\ \textcolor{keywordtype}{byte}\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{MFRC522::PCD\_ReadRegister}}(\ \ \ \ PCD\_Register\ reg\ \ \ \ }
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordtype}{byte}\ value;}
\DoxyCodeLine{00082\ \ \ \ \ SPI.beginTransaction(SPISettings(MFRC522\_SPICLOCK,\ MSBFIRST,\ SPI\_MODE0));\ \ \ \textcolor{comment}{//\ Set\ the\ settings\ to\ work\ with\ SPI\ bus}}
\DoxyCodeLine{00083\ \ \ \ \ digitalWrite(\_chipSelectPin,\ LOW);\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Select\ slave}}
\DoxyCodeLine{00084\ \ \ \ \ SPI.transfer(0x80\ |\ reg);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ MSB\ ==\ 1\ is\ for\ reading.\ LSB\ is\ not\ used\ in\ address.\ Datasheet\ section\ 8.1.2.3.}}
\DoxyCodeLine{00085\ \ \ \ \ value\ =\ SPI.transfer(0);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ the\ value\ back.\ Send\ 0\ to\ stop\ reading.}}
\DoxyCodeLine{00086\ \ \ \ \ digitalWrite(\_chipSelectPin,\ HIGH);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Release\ slave\ again}}
\DoxyCodeLine{00087\ \ \ \ \ SPI.endTransaction();\ \textcolor{comment}{//\ Stop\ using\ the\ SPI\ bus}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordflow}{return}\ value;}
\DoxyCodeLine{00089\ \}\ \textcolor{comment}{//\ End\ PCD\_ReadRegister()}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00095\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{MFRC522::PCD\_ReadRegister}}(\ \ \ \ PCD\_Register\ reg,\ \ \ }
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ count,\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *values,\ \ \ \ \ \ \ }
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ rxAlign\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordflow}{if}\ (count\ ==\ 0)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00102\ \ \ \ \ \}}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//Serial.print(F("{}Reading\ "{}));\ \ Serial.print(count);\ Serial.println(F("{}\ bytes\ from\ register."{}));}}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordtype}{byte}\ address\ =\ 0x80\ |\ reg;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ MSB\ ==\ 1\ is\ for\ reading.\ LSB\ is\ not\ used\ in\ address.\ Datasheet\ section\ 8.1.2.3.}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordtype}{byte}\ index\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Index\ in\ values\ array.}}
\DoxyCodeLine{00106\ \ \ \ \ SPI.beginTransaction(SPISettings(MFRC522\_SPICLOCK,\ MSBFIRST,\ SPI\_MODE0));\ \ \ \textcolor{comment}{//\ Set\ the\ settings\ to\ work\ with\ SPI\ bus}}
\DoxyCodeLine{00107\ \ \ \ \ digitalWrite(\_chipSelectPin,\ LOW);\ \ \ \ \ \ \textcolor{comment}{//\ Select\ slave}}
\DoxyCodeLine{00108\ \ \ \ \ count-\/-\/;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ One\ read\ is\ performed\ outside\ of\ the\ loop}}
\DoxyCodeLine{00109\ \ \ \ \ SPI.transfer(address);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Tell\ MFRC522\ which\ address\ we\ want\ to\ read}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{if}\ (rxAlign)\ \{\ \ \ \ \ \ \textcolor{comment}{//\ Only\ update\ bit\ positions\ rxAlign..7\ in\ values[0]}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ bit\ mask\ for\ bit\ positions\ rxAlign..7}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ mask\ =\ (0xFF\ <<\ rxAlign)\ \&\ 0xFF;}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ value\ and\ tell\ that\ we\ want\ to\ read\ the\ same\ address\ again.}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ value\ =\ SPI.transfer(address);}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Apply\ mask\ to\ both\ current\ value\ of\ values[0]\ and\ the\ new\ data\ in\ value.}}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ values[0]\ =\ (values[0]\ \&\ \string~mask)\ |\ (value\ \&\ mask);}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ index++;}
\DoxyCodeLine{00118\ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{while}\ (index\ <\ count)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ values[index]\ =\ SPI.transfer(address);\ \ \textcolor{comment}{//\ Read\ value\ and\ tell\ that\ we\ want\ to\ read\ the\ same\ address\ again.}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ index++;}
\DoxyCodeLine{00122\ \ \ \ \ \}}
\DoxyCodeLine{00123\ \ \ \ \ values[index]\ =\ SPI.transfer(0);\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ the\ final\ byte.\ Send\ 0\ to\ stop\ reading.}}
\DoxyCodeLine{00124\ \ \ \ \ digitalWrite(\_chipSelectPin,\ HIGH);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Release\ slave\ again}}
\DoxyCodeLine{00125\ \ \ \ \ SPI.endTransaction();\ \textcolor{comment}{//\ Stop\ using\ the\ SPI\ bus}}
\DoxyCodeLine{00126\ \}\ \textcolor{comment}{//\ End\ PCD\_ReadRegister()}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00131\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_acebb9a90249419f2a53281c4a13727d1}{MFRC522::PCD\_SetRegisterBitMask}}(\ \ \ \ PCD\_Register\ reg,\ \ \ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ mask\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordtype}{byte}\ tmp;}
\DoxyCodeLine{00135\ \ \ \ \ tmp\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(reg);}
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(reg,\ tmp\ |\ mask);\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ bit\ mask}}
\DoxyCodeLine{00137\ \}\ \textcolor{comment}{//\ End\ PCD\_SetRegisterBitMask()}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00142\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a76193f4f8916f688fe2b7976d0fd1dc2}{MFRC522::PCD\_ClearRegisterBitMask}}(\ \ \ \ PCD\_Register\ reg,\ \ \ }
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ mask\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{byte}\ tmp;}
\DoxyCodeLine{00146\ \ \ \ \ tmp\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(reg);}
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(reg,\ tmp\ \&\ (\string~mask));\ \ \ \ \ \textcolor{comment}{//\ clear\ bit\ mask}}
\DoxyCodeLine{00148\ \}\ \textcolor{comment}{//\ End\ PCD\_ClearRegisterBitMask()}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00156\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a7c65647b1d72b6ee7557797322030643}{MFRC522::PCD\_CalculateCRC}}(\ \textcolor{keywordtype}{byte}\ *data,\ \ \ \ \ }
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ length,\ \ \ \ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *result\ \ \ \ }
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ PCD\_Idle);\ \ \ \ \ \ \ \textcolor{comment}{//\ Stop\ any\ active\ command.}}
\DoxyCodeLine{00161\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(DivIrqReg,\ 0x04);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ the\ CRCIRq\ interrupt\ request\ bit}}
\DoxyCodeLine{00162\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(FIFOLevelReg,\ 0x80);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ FlushBuffer\ =\ 1,\ FIFO\ initialization}}
\DoxyCodeLine{00163\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(FIFODataReg,\ length,\ data);\ \ \textcolor{comment}{//\ Write\ data\ to\ the\ FIFO}}
\DoxyCodeLine{00164\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ PCD\_CalcCRC);\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ the\ calculation}}
\DoxyCodeLine{00165\ \ \ \ \ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ the\ CRC\ calculation\ to\ complete.\ Check\ for\ the\ register\ to}}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ indicate\ that\ the\ CRC\ calculation\ is\ complete\ in\ a\ loop.\ If\ the}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ calculation\ is\ not\ indicated\ as\ complete\ in\ \string~90ms,\ then\ time\ out}}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{comment}{//\ the\ operation.}}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ deadline\ =\ millis()\ +\ 89;}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DivIrqReg[7..0]\ bits\ are:\ Set2\ reserved\ reserved\ MfinActIRq\ reserved\ CRCIRq\ reserved\ reserved}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ n\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(DivIrqReg);}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ \&\ 0x04)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CRCIRq\ bit\ set\ -\/\ calculation\ done}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ PCD\_Idle);\ \ \ \textcolor{comment}{//\ Stop\ calculating\ CRC\ for\ new\ content\ in\ the\ FIFO.}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transfer\ the\ result\ from\ the\ registers\ to\ the\ result\ buffer}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ result[0]\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(CRCResultRegL);}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ result[1]\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(CRCResultRegH);}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ yield();}
\DoxyCodeLine{00183\ \ \ \ \ \}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}\ (millis())\ <\ deadline);}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//\ 89ms\ passed\ and\ nothing\ happened.\ Communication\ with\ the\ MFRC522\ might\ be\ down.}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_TIMEOUT;}
\DoxyCodeLine{00188\ \}\ \textcolor{comment}{//\ End\ PCD\_CalculateCRC()}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00192\ \textcolor{comment}{//\ Functions\ for\ manipulating\ the\ MFRC522}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00198\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_ad681e424fc68a57941bea5702cee05eb}{MFRC522::PCD\_Init}}()\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{bool}\ hardReset\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ chipSelectPin\ as\ digital\ output,\ do\ not\ select\ the\ slave\ yet}}
\DoxyCodeLine{00202\ \ \ \ \ pinMode(\_chipSelectPin,\ OUTPUT);}
\DoxyCodeLine{00203\ \ \ \ \ digitalWrite(\_chipSelectPin,\ HIGH);}
\DoxyCodeLine{00204\ \ \ \ \ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{comment}{//\ If\ a\ valid\ pin\ number\ has\ been\ set,\ pull\ device\ out\ of\ power\ down\ /\ reset\ state.}}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_resetPowerDownPin\ !=\ UNUSED\_PIN)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ set\ the\ resetPowerDownPin\ as\ digital\ input,\ to\ check\ the\ MFRC522\ power\ down\ mode.}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ pinMode(\_resetPowerDownPin,\ INPUT);}
\DoxyCodeLine{00209\ \ \ \ \ }
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (digitalRead(\_resetPowerDownPin)\ ==\ LOW)\ \{\ \ \ \textcolor{comment}{//\ The\ MFRC522\ chip\ is\ in\ power\ down\ mode.}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ pinMode(\_resetPowerDownPin,\ OUTPUT);\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ set\ the\ resetPowerDownPin\ as\ digital\ output.}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ digitalWrite(\_resetPowerDownPin,\ LOW);\ \ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ we\ have\ a\ clean\ LOW\ state.}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ delayMicroseconds(2);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 8.8.1\ Reset\ timing\ requirements\ says\ about\ 100ns.\ Let\ us\ be\ generous:\ 2μsl}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ digitalWrite(\_resetPowerDownPin,\ HIGH);\ \ \ \ \ \textcolor{comment}{//\ Exit\ power\ down\ mode.\ This\ triggers\ a\ hard\ reset.}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Section\ 8.8.2\ in\ the\ datasheet\ says\ the\ oscillator\ start-\/up\ time\ is\ the\ start\ up\ time\ of\ the\ crystal\ +\ 37,74μs.\ Let\ us\ be\ generous:\ 50ms.}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ delay(50);}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ hardReset\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{if}\ (!hardReset)\ \{\ \textcolor{comment}{//\ Perform\ a\ soft\ reset\ if\ we\ haven't\ triggered\ a\ hard\ reset\ above.}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_a9886678ea0a65021bf602cfb110caa15}{PCD\_Reset}}();}
\DoxyCodeLine{00223\ \ \ \ \ \}}
\DoxyCodeLine{00224\ \ \ \ \ }
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ Reset\ baud\ rates}}
\DoxyCodeLine{00226\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(TxModeReg,\ 0x00);}
\DoxyCodeLine{00227\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(RxModeReg,\ 0x00);}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ Reset\ ModWidthReg}}
\DoxyCodeLine{00229\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(ModWidthReg,\ 0x26);}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{comment}{//\ When\ communicating\ with\ a\ PICC\ we\ need\ a\ timeout\ if\ something\ goes\ wrong.}}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{comment}{//\ f\_timer\ =\ 13.56\ MHz\ /\ (2*TPreScaler+1)\ where\ TPreScaler\ =\ [TPrescaler\_Hi:TPrescaler\_Lo].}}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ TPrescaler\_Hi\ are\ the\ four\ low\ bits\ in\ TModeReg.\ TPrescaler\_Lo\ is\ TPrescalerReg.}}
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(TModeReg,\ 0x80);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TAuto=1;\ timer\ starts\ automatically\ at\ the\ end\ of\ the\ transmission\ in\ all\ communication\ modes\ at\ all\ speeds}}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(TPrescalerReg,\ 0xA9);\ \ \ \ \ \ \ \ \textcolor{comment}{//\ TPreScaler\ =\ TModeReg[3..0]:TPrescalerReg,\ ie\ 0x0A9\ =\ 169\ =>\ f\_timer=40kHz,\ ie\ a\ timer\ period\ of\ 25μs.}}
\DoxyCodeLine{00236\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(TReloadRegH,\ 0x03);\ \ \ \ \ \ \textcolor{comment}{//\ Reload\ timer\ with\ 0x3E8\ =\ 1000,\ ie\ 25ms\ before\ timeout.}}
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(TReloadRegL,\ 0xE8);}
\DoxyCodeLine{00238\ \ \ \ \ }
\DoxyCodeLine{00239\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(TxASKReg,\ 0x40);\ \ \ \ \ \textcolor{comment}{//\ Default\ 0x00.\ Force\ a\ 100\ \%\ ASK\ modulation\ independent\ of\ the\ ModGsPReg\ register\ setting}}
\DoxyCodeLine{00240\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(ModeReg,\ 0x3D);\ \ \ \ \ \ \textcolor{comment}{//\ Default\ 0x3F.\ Set\ the\ preset\ value\ for\ the\ CRC\ coprocessor\ for\ the\ CalcCRC\ command\ to\ 0x6363\ (ISO\ 14443-\/3\ part\ 6.2.4)}}
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a044be037a5f172e9cea7d8ce1dcf32e0}{PCD\_AntennaOn}}();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enable\ the\ antenna\ driver\ pins\ TX1\ and\ TX2\ (they\ were\ disabled\ by\ the\ reset)}}
\DoxyCodeLine{00242\ \}\ \textcolor{comment}{//\ End\ PCD\_Init()}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00247\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_ad681e424fc68a57941bea5702cee05eb}{MFRC522::PCD\_Init}}(\ \ \ \ \textcolor{keywordtype}{byte}\ resetPowerDownPin\ \ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \mbox{\hyperlink{classMFRC522_ad681e424fc68a57941bea5702cee05eb}{PCD\_Init}}(SS,\ resetPowerDownPin);\ \textcolor{comment}{//\ SS\ is\ defined\ in\ pins\_arduino.h}}
\DoxyCodeLine{00250\ \}\ \textcolor{comment}{//\ End\ PCD\_Init()}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00255\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_ad681e424fc68a57941bea5702cee05eb}{MFRC522::PCD\_Init}}(\ \ \ \ \textcolor{keywordtype}{byte}\ chipSelectPin,\ \ \ \ \ }
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ resetPowerDownPin\ \ }
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \_chipSelectPin\ =\ chipSelectPin;}
\DoxyCodeLine{00259\ \ \ \ \ \_resetPowerDownPin\ =\ resetPowerDownPin;\ }
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ chipSelectPin\ as\ digital\ output,\ do\ not\ select\ the\ slave\ yet}}
\DoxyCodeLine{00261\ \ \ \ \ \mbox{\hyperlink{classMFRC522_ad681e424fc68a57941bea5702cee05eb}{PCD\_Init}}();}
\DoxyCodeLine{00262\ \}\ \textcolor{comment}{//\ End\ PCD\_Init()}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00267\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a9886678ea0a65021bf602cfb110caa15}{MFRC522::PCD\_Reset}}()\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ PCD\_SoftReset);\ \ \textcolor{comment}{//\ Issue\ the\ SoftReset\ command.}}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{comment}{//\ The\ datasheet\ does\ not\ mention\ how\ long\ the\ SoftRest\ command\ takes\ to\ complete.}}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{comment}{//\ But\ the\ MFRC522\ might\ have\ been\ in\ soft\ power-\/down\ mode\ (triggered\ by\ bit\ 4\ of\ CommandReg)\ }}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{comment}{//\ Section\ 8.8.2\ in\ the\ datasheet\ says\ the\ oscillator\ start-\/up\ time\ is\ the\ start\ up\ time\ of\ the\ crystal\ +\ 37,74μs.\ Let\ us\ be\ generous:\ 50ms.}}
\DoxyCodeLine{00272\ \ \ \ \ uint8\_t\ count\ =\ 0;}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait\ for\ the\ PowerDown\ bit\ in\ CommandReg\ to\ be\ cleared\ (max\ 3x50ms)}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ delay(50);}
\DoxyCodeLine{00276\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ ((\mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(CommandReg)\ \&\ (1\ <<\ 4))\ \&\&\ (++count)\ <\ 3);}
\DoxyCodeLine{00277\ \}\ \textcolor{comment}{//\ End\ PCD\_Reset()}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00283\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a044be037a5f172e9cea7d8ce1dcf32e0}{MFRC522::PCD\_AntennaOn}}()\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordtype}{byte}\ value\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(TxControlReg);}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{keywordflow}{if}\ ((value\ \&\ 0x03)\ !=\ 0x03)\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(TxControlReg,\ value\ |\ 0x03);}
\DoxyCodeLine{00287\ \ \ \ \ \}}
\DoxyCodeLine{00288\ \}\ \textcolor{comment}{//\ End\ PCD\_AntennaOn()}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00293\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a2098ebe85700109b20c5026643f1dad7}{MFRC522::PCD\_AntennaOff}}()\ \{}
\DoxyCodeLine{00294\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a76193f4f8916f688fe2b7976d0fd1dc2}{PCD\_ClearRegisterBitMask}}(TxControlReg,\ 0x03);}
\DoxyCodeLine{00295\ \}\ \textcolor{comment}{//\ End\ PCD\_AntennaOff()}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00304\ \textcolor{keywordtype}{byte}\ \mbox{\hyperlink{classMFRC522_aa02ae994a9ebf146475f46fc538cef28}{MFRC522::PCD\_GetAntennaGain}}()\ \{}
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(RFCfgReg)\ \&\ (0x07<<4);}
\DoxyCodeLine{00306\ \}\ \textcolor{comment}{//\ End\ PCD\_GetAntennaGain()}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00313\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a5ce84dd855f2ae297dd00fafaf62ef78}{MFRC522::PCD\_SetAntennaGain}}(\textcolor{keywordtype}{byte}\ mask)\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMFRC522_aa02ae994a9ebf146475f46fc538cef28}{PCD\_GetAntennaGain}}()\ !=\ mask)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ only\ bother\ if\ there\ is\ a\ change}}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_a76193f4f8916f688fe2b7976d0fd1dc2}{PCD\_ClearRegisterBitMask}}(RFCfgReg,\ (0x07<<4));\ \ \ \ \ \ \textcolor{comment}{//\ clear\ needed\ to\ allow\ 000\ pattern}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_acebb9a90249419f2a53281c4a13727d1}{PCD\_SetRegisterBitMask}}(RFCfgReg,\ mask\ \&\ (0x07<<4));\ \ \ \textcolor{comment}{//\ only\ set\ RxGain[2:0]\ bits}}
\DoxyCodeLine{00317\ \ \ \ \ \}}
\DoxyCodeLine{00318\ \}\ \textcolor{comment}{//\ End\ PCD\_SetAntennaGain()}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00326\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMFRC522_a25f052c9c340da34128c365662370b01}{MFRC522::PCD\_PerformSelfTest}}()\ \{}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{comment}{//\ This\ follows\ directly\ the\ steps\ outlined\ in\ 16.1.1}}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{comment}{//\ 1.\ Perform\ a\ soft\ reset.}}
\DoxyCodeLine{00329\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a9886678ea0a65021bf602cfb110caa15}{PCD\_Reset}}();}
\DoxyCodeLine{00330\ \ \ \ \ }
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{comment}{//\ 2.\ Clear\ the\ internal\ buffer\ by\ writing\ 25\ bytes\ of\ 00h}}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordtype}{byte}\ ZEROES[25]\ =\ \{0x00\};}
\DoxyCodeLine{00333\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(FIFOLevelReg,\ 0x80);\ \ \ \ \ \textcolor{comment}{//\ flush\ the\ FIFO\ buffer}}
\DoxyCodeLine{00334\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(FIFODataReg,\ 25,\ ZEROES);\ \ \ \ \textcolor{comment}{//\ write\ 25\ bytes\ of\ 00h\ to\ FIFO}}
\DoxyCodeLine{00335\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ PCD\_Mem);\ \ \ \ \ \ \ \ \textcolor{comment}{//\ transfer\ to\ internal\ buffer}}
\DoxyCodeLine{00336\ \ \ \ \ }
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{comment}{//\ 3.\ Enable\ self-\/test}}
\DoxyCodeLine{00338\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(AutoTestReg,\ 0x09);}
\DoxyCodeLine{00339\ \ \ \ \ }
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{comment}{//\ 4.\ Write\ 00h\ to\ FIFO\ buffer}}
\DoxyCodeLine{00341\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(FIFODataReg,\ 0x00);}
\DoxyCodeLine{00342\ \ \ \ \ }
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{//\ 5.\ Start\ self-\/test\ by\ issuing\ the\ CalcCRC\ command}}
\DoxyCodeLine{00344\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ PCD\_CalcCRC);}
\DoxyCodeLine{00345\ \ \ \ \ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ 6.\ Wait\ for\ self-\/test\ to\ complete}}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{keywordtype}{byte}\ n;}
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ i\ =\ 0;\ i\ <\ 0xFF;\ i++)\ \{}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ datasheet\ does\ not\ specify\ exact\ completion\ condition\ except}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ that\ FIFO\ buffer\ should\ contain\ 64\ bytes.}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ While\ selftest\ is\ initiated\ by\ CalcCRC\ command}}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ it\ behaves\ differently\ from\ normal\ CRC\ computation,}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ so\ one\ can't\ reliably\ use\ DivIrqReg\ to\ check\ for\ completion.}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ is\ reported\ that\ some\ devices\ does\ not\ trigger\ CRCIRq\ flag}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ during\ selftest.}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ n\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(FIFOLevelReg);}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ >=\ 64)\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00360\ \ \ \ \ \}}
\DoxyCodeLine{00361\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ PCD\_Idle);\ \ \ \ \ \ \ \textcolor{comment}{//\ Stop\ calculating\ CRC\ for\ new\ content\ in\ the\ FIFO.}}
\DoxyCodeLine{00362\ \ \ \ \ }
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{comment}{//\ 7.\ Read\ out\ resulting\ 64\ bytes\ from\ the\ FIFO\ buffer.}}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordtype}{byte}\ result[64];}
\DoxyCodeLine{00365\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(FIFODataReg,\ 64,\ result,\ 0);}
\DoxyCodeLine{00366\ \ \ \ \ }
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{comment}{//\ Auto\ self-\/test\ done}}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{comment}{//\ Reset\ AutoTestReg\ register\ to\ be\ 0\ again.\ Required\ for\ normal\ operation.}}
\DoxyCodeLine{00369\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(AutoTestReg,\ 0x00);}
\DoxyCodeLine{00370\ \ \ \ \ }
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{comment}{//\ Determine\ firmware\ version\ (see\ section\ 9.3.4.8\ in\ spec)}}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keywordtype}{byte}\ version\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(VersionReg);}
\DoxyCodeLine{00373\ \ \ \ \ }
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{comment}{//\ Pick\ the\ appropriate\ reference\ values}}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{byte}\ *reference;}
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{keywordflow}{switch}\ (version)\ \{}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x88:\ \ \textcolor{comment}{//\ Fudan\ Semiconductor\ FM17522\ clone}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ reference\ =\ FM17522\_firmware\_reference;}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x90:\ \ \textcolor{comment}{//\ Version\ 0.0}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ reference\ =\ MFRC522\_firmware\_referenceV0\_0;}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x91:\ \ \textcolor{comment}{//\ Version\ 1.0}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ reference\ =\ MFRC522\_firmware\_referenceV1\_0;}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x92:\ \ \textcolor{comment}{//\ Version\ 2.0}}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ reference\ =\ MFRC522\_firmware\_referenceV2\_0;}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \ \ \ \textcolor{comment}{//\ Unknown\ version}}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ abort\ test}}
\DoxyCodeLine{00391\ \ \ \ \ \}}
\DoxyCodeLine{00392\ \ \ \ \ }
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{comment}{//\ Verify\ that\ the\ results\ match\ up\ to\ our\ expectations}}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ i\ =\ 0;\ i\ <\ 64;\ i++)\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result[i]\ !=\ pgm\_read\_byte(\&(reference[i])))\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00398\ \ \ \ \ \}}
\DoxyCodeLine{00399\ \ \ \ \ }
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{comment}{//\ 8.\ Perform\ a\ re-\/init,\ because\ PCD\ does\ not\ work\ after\ test.}}
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{comment}{//\ Reset\ does\ not\ work\ as\ expected.}}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{comment}{//\ "{}Auto\ self-\/test\ done"{}\ does\ not\ work\ as\ expected.}}
\DoxyCodeLine{00403\ \ \ \ \ \mbox{\hyperlink{classMFRC522_ad681e424fc68a57941bea5702cee05eb}{PCD\_Init}}();}
\DoxyCodeLine{00404\ \ \ \ \ }
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{comment}{//\ Test\ passed;\ all\ is\ good.}}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00407\ \}\ \textcolor{comment}{//\ End\ PCD\_PerformSelfTest()}}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00410\ \textcolor{comment}{//\ Power\ control}}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \textcolor{comment}{//IMPORTANT\ NOTE!!!!}}
\DoxyCodeLine{00414\ \textcolor{comment}{//Calling\ any\ other\ function\ that\ uses\ CommandReg\ will\ disable\ soft\ power\ down\ mode\ !!!}}
\DoxyCodeLine{00415\ \textcolor{comment}{//For\ more\ details\ about\ power\ control,\ refer\ to\ the\ datasheet\ -\/\ page\ 33\ (8.6)}}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \textcolor{keywordtype}{void}\ MFRC522::PCD\_SoftPowerDown()\{\textcolor{comment}{//Note\ :\ Only\ soft\ power\ down\ mode\ is\ available\ throught\ software}}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{keywordtype}{byte}\ val\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(CommandReg);\ \textcolor{comment}{//\ Read\ state\ of\ the\ command\ register\ }}
\DoxyCodeLine{00419\ \ \ \ \ val\ |=\ (1<<4);\textcolor{comment}{//\ set\ PowerDown\ bit\ (\ bit\ 4\ )\ to\ 1\ }}
\DoxyCodeLine{00420\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ val);\textcolor{comment}{//write\ new\ value\ to\ the\ command\ register}}
\DoxyCodeLine{00421\ \}}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \textcolor{keywordtype}{void}\ MFRC522::PCD\_SoftPowerUp()\{}
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{keywordtype}{byte}\ val\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(CommandReg);\ \textcolor{comment}{//\ Read\ state\ of\ the\ command\ register\ }}
\DoxyCodeLine{00425\ \ \ \ \ val\ \&=\ \string~(1<<4);\textcolor{comment}{//\ set\ PowerDown\ bit\ (\ bit\ 4\ )\ to\ 0\ }}
\DoxyCodeLine{00426\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ val);\textcolor{comment}{//write\ new\ value\ to\ the\ command\ register}}
\DoxyCodeLine{00427\ \ \ \ \ \textcolor{comment}{//\ wait\ until\ PowerDown\ bit\ is\ cleared\ (this\ indicates\ end\ of\ wake\ up\ procedure)\ }}
\DoxyCodeLine{00428\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ timeout\ =\ (uint32\_t)millis()\ +\ 500;\textcolor{comment}{//\ create\ timer\ for\ timeout\ (just\ in\ case)\ }}
\DoxyCodeLine{00429\ \ \ \ \ }
\DoxyCodeLine{00430\ \ \ \ \ \textcolor{keywordflow}{while}(millis()<=timeout)\{\ \textcolor{comment}{//\ set\ timeout\ to\ 500\ ms\ }}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ val\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(CommandReg);\textcolor{comment}{//\ Read\ state\ of\ the\ command\ register}}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!(val\ \&\ (1<<4)))\{\ \textcolor{comment}{//\ if\ powerdown\ bit\ is\ 0\ }}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\textcolor{comment}{//\ wake\ up\ procedure\ is\ finished\ }}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ yield();}
\DoxyCodeLine{00436\ \ \ \ \ \}}
\DoxyCodeLine{00437\ \}}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00440\ \textcolor{comment}{//\ Functions\ for\ communicating\ with\ PICCs}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00449\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_aaa96aa7ec4f95e0835cb758ad0450d74}{MFRC522::PCD\_TransceiveData}}(\ \textcolor{keywordtype}{byte}\ *sendData,\ \ \ \ \ }
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ sendLen,\ \ \ \ \ \ \ }
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *backData,\ \ \ \ \ }
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *backLen,\ \ \ \ \ \ }
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *validBits,\ \ \ \ }
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ rxAlign,\ \ \ \ \ \ \ }
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ checkCRC\ \ \ \ \ \ \ }
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00457\ \ \ \ \ \textcolor{keywordtype}{byte}\ waitIRq\ =\ 0x30;\ \ \ \ \ \ \ \ \textcolor{comment}{//\ RxIRq\ and\ IdleIRq}}
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_acb2b1e74bc49fda2704450a684faa845}{PCD\_CommunicateWithPICC}}(PCD\_Transceive,\ waitIRq,\ sendData,\ sendLen,\ backData,\ backLen,\ validBits,\ rxAlign,\ checkCRC);}
\DoxyCodeLine{00459\ \}\ \textcolor{comment}{//\ End\ PCD\_TransceiveData()}}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00467\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_acb2b1e74bc49fda2704450a684faa845}{MFRC522::PCD\_CommunicateWithPICC}}(\ \ \ \textcolor{keywordtype}{byte}\ command,\ \ \ \ \ \ \ }
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ waitIRq,\ \ \ \ \ \ \ }
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *sendData,\ \ \ \ \ }
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ sendLen,\ \ \ \ \ \ \ }
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *backData,\ \ \ \ \ }
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *backLen,\ \ \ \ \ \ }
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *validBits,\ \ \ \ }
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ rxAlign,\ \ \ \ \ \ \ }
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ checkCRC\ \ \ \ \ \ \ }
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00477\ \ \ \ \ \textcolor{comment}{//\ Prepare\ values\ for\ BitFramingReg}}
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{keywordtype}{byte}\ txLastBits\ =\ validBits\ ?\ *validBits\ :\ 0;}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{keywordtype}{byte}\ bitFraming\ =\ (rxAlign\ <<\ 4)\ +\ txLastBits;\ \ \ \ \ \ \textcolor{comment}{//\ RxAlign\ =\ BitFramingReg[6..4].\ TxLastBits\ =\ BitFramingReg[2..0]}}
\DoxyCodeLine{00480\ \ \ \ \ }
\DoxyCodeLine{00481\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ PCD\_Idle);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Stop\ any\ active\ command.}}
\DoxyCodeLine{00482\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(ComIrqReg,\ 0x7F);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ all\ seven\ interrupt\ request\ bits}}
\DoxyCodeLine{00483\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(FIFOLevelReg,\ 0x80);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ FlushBuffer\ =\ 1,\ FIFO\ initialization}}
\DoxyCodeLine{00484\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(FIFODataReg,\ sendLen,\ sendData);\ \textcolor{comment}{//\ Write\ sendData\ to\ the\ FIFO}}
\DoxyCodeLine{00485\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(BitFramingReg,\ bitFraming);\ \ \ \ \ \ \textcolor{comment}{//\ Bit\ adjustments}}
\DoxyCodeLine{00486\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(CommandReg,\ command);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Execute\ the\ command}}
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{keywordflow}{if}\ (command\ ==\ PCD\_Transceive)\ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_acebb9a90249419f2a53281c4a13727d1}{PCD\_SetRegisterBitMask}}(BitFramingReg,\ 0x80);\ \ \textcolor{comment}{//\ StartSend=1,\ transmission\ of\ data\ starts}}
\DoxyCodeLine{00489\ \ \ \ \ \}}
\DoxyCodeLine{00490\ \ \ \ \ }
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{comment}{//\ In\ PCD\_Init()\ we\ set\ the\ TAuto\ flag\ in\ TModeReg.\ This\ means\ the\ timer}}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{comment}{//\ automatically\ starts\ when\ the\ PCD\ stops\ transmitting.}}
\DoxyCodeLine{00493\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{comment}{//\ Wait\ here\ for\ the\ command\ to\ complete.\ The\ bits\ specified\ in\ the}}
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{comment}{//\ \`{}waitIRq`\ parameter\ define\ what\ bits\ constitute\ a\ completed\ command.}}
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{comment}{//\ When\ they\ are\ set\ in\ the\ ComIrqReg\ register,\ then\ the\ command\ is}}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{comment}{//\ considered\ complete.\ If\ the\ command\ is\ not\ indicated\ as\ complete\ in}}
\DoxyCodeLine{00498\ \ \ \ \ \textcolor{comment}{//\ \string~36ms,\ then\ consider\ the\ command\ as\ timed\ out.}}
\DoxyCodeLine{00499\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ deadline\ =\ millis()\ +\ 36;}
\DoxyCodeLine{00500\ \ \ \ \ \textcolor{keywordtype}{bool}\ completed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ n\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(ComIrqReg);\ \ \ \textcolor{comment}{//\ ComIrqReg[7..0]\ bits\ are:\ Set1\ TxIRq\ RxIRq\ IdleIRq\ HiAlertIRq\ LoAlertIRq\ ErrIRq\ TimerIRq}}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ \&\ waitIRq)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ One\ of\ the\ interrupts\ that\ signal\ success\ has\ been\ set.}}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ completed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ \&\ 0x01)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timer\ interrupt\ -\/\ nothing\ received\ in\ 25ms}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_TIMEOUT;}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ yield();}
\DoxyCodeLine{00512\ \ \ \ \ \}}
\DoxyCodeLine{00513\ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}\ (millis())\ <\ deadline);}
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{comment}{//\ 36ms\ and\ nothing\ happened.\ Communication\ with\ the\ MFRC522\ might\ be\ down.}}
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{keywordflow}{if}\ (!completed)\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_TIMEOUT;}
\DoxyCodeLine{00518\ \ \ \ \ \}}
\DoxyCodeLine{00519\ \ \ \ \ }
\DoxyCodeLine{00520\ \ \ \ \ \textcolor{comment}{//\ Stop\ now\ if\ any\ errors\ except\ collisions\ were\ detected.}}
\DoxyCodeLine{00521\ \ \ \ \ \textcolor{keywordtype}{byte}\ errorRegValue\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(ErrorReg);\ \textcolor{comment}{//\ ErrorReg[7..0]\ bits\ are:\ WrErr\ TempErr\ reserved\ BufferOvfl\ CollErr\ CRCErr\ ParityErr\ ProtocolErr}}
\DoxyCodeLine{00522\ \ \ \ \ \textcolor{keywordflow}{if}\ (errorRegValue\ \&\ 0x13)\ \{\ \ \textcolor{comment}{//\ BufferOvfl\ ParityErr\ ProtocolErr}}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_ERROR;}
\DoxyCodeLine{00524\ \ \ \ \ \}}
\DoxyCodeLine{00525\ \ \ }
\DoxyCodeLine{00526\ \ \ \ \ \textcolor{keywordtype}{byte}\ \_validBits\ =\ 0;}
\DoxyCodeLine{00527\ \ \ \ \ }
\DoxyCodeLine{00528\ \ \ \ \ \textcolor{comment}{//\ If\ the\ caller\ wants\ data\ back,\ get\ it\ from\ the\ MFRC522.}}
\DoxyCodeLine{00529\ \ \ \ \ \textcolor{keywordflow}{if}\ (backData\ \&\&\ backLen)\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ n\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(FIFOLevelReg);\ \ \ \ \textcolor{comment}{//\ Number\ of\ bytes\ in\ the\ FIFO}}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ >\ *backLen)\ \{}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_NO\_ROOM;}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ *backLen\ =\ n;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ bytes\ returned}}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(FIFODataReg,\ n,\ backData,\ rxAlign);\ \ \ \ \textcolor{comment}{//\ Get\ received\ data\ from\ FIFO}}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \_validBits\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(ControlReg)\ \&\ 0x07;\ \ \ \ \ \ \ \textcolor{comment}{//\ RxLastBits[2:0]\ indicates\ the\ number\ of\ valid\ bits\ in\ the\ last\ received\ byte.\ If\ this\ value\ is\ 000b,\ the\ whole\ byte\ is\ valid.}}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (validBits)\ \{}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \ \ \ *validBits\ =\ \_validBits;}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00540\ \ \ \ \ \}}
\DoxyCodeLine{00541\ \ \ \ \ }
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{comment}{//\ Tell\ about\ collisions}}
\DoxyCodeLine{00543\ \ \ \ \ \textcolor{keywordflow}{if}\ (errorRegValue\ \&\ 0x08)\ \{\ \ \ \ \ \textcolor{comment}{//\ CollErr}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_COLLISION;}
\DoxyCodeLine{00545\ \ \ \ \ \}}
\DoxyCodeLine{00546\ \ \ \ \ }
\DoxyCodeLine{00547\ \ \ \ \ \textcolor{comment}{//\ Perform\ CRC\_A\ validation\ if\ requested.}}
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{keywordflow}{if}\ (backData\ \&\&\ backLen\ \&\&\ checkCRC)\ \{}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ this\ case\ a\ MIFARE\ Classic\ NAK\ is\ not\ OK.}}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*backLen\ ==\ 1\ \&\&\ \_validBits\ ==\ 4)\ \{}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_MIFARE\_NACK;}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ at\ least\ the\ CRC\_A\ value\ and\ all\ 8\ bits\ of\ the\ last\ byte\ must\ be\ received.}}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*backLen\ <\ 2\ ||\ \_validBits\ !=\ 0)\ \{}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_CRC\_WRONG;}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verify\ CRC\_A\ -\/\ do\ our\ own\ calculation\ and\ store\ the\ control\ in\ controlBuffer.}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ controlBuffer[2];}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ MFRC522::StatusCode\ status\ =\ \mbox{\hyperlink{classMFRC522_a7c65647b1d72b6ee7557797322030643}{PCD\_CalculateCRC}}(\&backData[0],\ *backLen\ -\/\ 2,\ \&controlBuffer[0]);}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ status;}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((backData[*backLen\ -\/\ 2]\ !=\ controlBuffer[0])\ ||\ (backData[*backLen\ -\/\ 1]\ !=\ controlBuffer[1]))\ \{}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_CRC\_WRONG;}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00566\ \ \ \ \ \}}
\DoxyCodeLine{00567\ \ \ \ \ }
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{00569\ \}\ \textcolor{comment}{//\ End\ PCD\_CommunicateWithPICC()}}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00577\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a4e0ac6edf5e8f6ade351b009278fbbc7}{MFRC522::PICC\_RequestA}}(\ \ \ \textcolor{keywordtype}{byte}\ *bufferATQA,\ \ \ }
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *bufferSize\ \ \ \ }
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_a639d27ac072bc0dfa478d0957591afcc}{PICC\_REQA\_or\_WUPA}}(PICC\_CMD\_REQA,\ bufferATQA,\ bufferSize);}
\DoxyCodeLine{00581\ \}\ \textcolor{comment}{//\ End\ PICC\_RequestA()}}
\DoxyCodeLine{00582\ }
\DoxyCodeLine{00589\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_ad00a1efcfa6dc203ca885d43f4d02125}{MFRC522::PICC\_WakeupA}}(\ \textcolor{keywordtype}{byte}\ *bufferATQA,\ \ \ }
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *bufferSize\ \ \ \ }
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00592\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_a639d27ac072bc0dfa478d0957591afcc}{PICC\_REQA\_or\_WUPA}}(PICC\_CMD\_WUPA,\ bufferATQA,\ bufferSize);}
\DoxyCodeLine{00593\ \}\ \textcolor{comment}{//\ End\ PICC\_WakeupA()}}
\DoxyCodeLine{00594\ }
\DoxyCodeLine{00601\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a639d27ac072bc0dfa478d0957591afcc}{MFRC522::PICC\_REQA\_or\_WUPA}}(\ \ \ \textcolor{keywordtype}{byte}\ command,\ \ \ \ \ \ \ }
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *bufferATQA,\ \ \ }
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *bufferSize\ \ \ \ }
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00605\ \ \ \ \ \textcolor{keywordtype}{byte}\ validBits;}
\DoxyCodeLine{00606\ \ \ \ \ MFRC522::StatusCode\ status;}
\DoxyCodeLine{00607\ \ \ \ \ }
\DoxyCodeLine{00608\ \ \ \ \ \textcolor{keywordflow}{if}\ (bufferATQA\ ==\ \textcolor{keyword}{nullptr}\ ||\ *bufferSize\ <\ 2)\ \{\ \textcolor{comment}{//\ The\ ATQA\ response\ is\ 2\ bytes\ long.}}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_NO\_ROOM;}
\DoxyCodeLine{00610\ \ \ \ \ \}}
\DoxyCodeLine{00611\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a76193f4f8916f688fe2b7976d0fd1dc2}{PCD\_ClearRegisterBitMask}}(CollReg,\ 0x80);\ \ \ \ \ \ \ \ \textcolor{comment}{//\ ValuesAfterColl=1\ =>\ Bits\ received\ after\ collision\ are\ cleared.}}
\DoxyCodeLine{00612\ \ \ \ \ validBits\ =\ 7;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ REQA\ and\ WUPA\ we\ need\ the\ short\ frame\ format\ -\/\ transmit\ only\ 7\ bits\ of\ the\ last\ (and\ only)\ byte.\ TxLastBits\ =\ BitFramingReg[2..0]}}
\DoxyCodeLine{00613\ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_aaa96aa7ec4f95e0835cb758ad0450d74}{PCD\_TransceiveData}}(\&command,\ 1,\ bufferATQA,\ bufferSize,\ \&validBits);}
\DoxyCodeLine{00614\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ status;}
\DoxyCodeLine{00616\ \ \ \ \ \}}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{keywordflow}{if}\ (*bufferSize\ !=\ 2\ ||\ validBits\ !=\ 0)\ \{\ \ \ \ \ \ \ \textcolor{comment}{//\ ATQA\ must\ be\ exactly\ 16\ bits.}}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_ERROR;}
\DoxyCodeLine{00619\ \ \ \ \ \}}
\DoxyCodeLine{00620\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{00621\ \}\ \textcolor{comment}{//\ End\ PICC\_REQA\_or\_WUPA()}}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00640\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a7a78c629cb4e1d90cc2d7526b17d6c22}{MFRC522::PICC\_Select}}(\ \ \ \mbox{\hyperlink{classMFRC522_structMFRC522_1_1Uid}{Uid}}\ *uid,\ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ validBits\ \ \ \ \ \ }
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00643\ \ \ \ \ \textcolor{keywordtype}{bool}\ uidComplete;}
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{keywordtype}{bool}\ selectDone;}
\DoxyCodeLine{00645\ \ \ \ \ \textcolor{keywordtype}{bool}\ useCascadeTag;}
\DoxyCodeLine{00646\ \ \ \ \ \textcolor{keywordtype}{byte}\ cascadeLevel\ =\ 1;}
\DoxyCodeLine{00647\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{00648\ \ \ \ \ \textcolor{keywordtype}{byte}\ count;}
\DoxyCodeLine{00649\ \ \ \ \ \textcolor{keywordtype}{byte}\ checkBit;}
\DoxyCodeLine{00650\ \ \ \ \ \textcolor{keywordtype}{byte}\ index;}
\DoxyCodeLine{00651\ \ \ \ \ \textcolor{keywordtype}{byte}\ uidIndex;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ first\ index\ in\ uid-\/>uidByte[]\ that\ is\ used\ in\ the\ current\ Cascade\ Level.}}
\DoxyCodeLine{00652\ \ \ \ \ int8\_t\ currentLevelKnownBits;\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ known\ UID\ bits\ in\ the\ current\ Cascade\ Level.}}
\DoxyCodeLine{00653\ \ \ \ \ \textcolor{keywordtype}{byte}\ buffer[9];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ SELECT/ANTICOLLISION\ commands\ uses\ a\ 7\ byte\ standard\ frame\ +\ 2\ bytes\ CRC\_A}}
\DoxyCodeLine{00654\ \ \ \ \ \textcolor{keywordtype}{byte}\ bufferUsed;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ bytes\ used\ in\ the\ buffer,\ ie\ the\ number\ of\ bytes\ to\ transfer\ to\ the\ FIFO.}}
\DoxyCodeLine{00655\ \ \ \ \ \textcolor{keywordtype}{byte}\ rxAlign;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Used\ in\ BitFramingReg.\ Defines\ the\ bit\ position\ for\ the\ first\ bit\ received.}}
\DoxyCodeLine{00656\ \ \ \ \ \textcolor{keywordtype}{byte}\ txLastBits;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Used\ in\ BitFramingReg.\ The\ number\ of\ valid\ bits\ in\ the\ last\ transmitted\ byte.\ }}
\DoxyCodeLine{00657\ \ \ \ \ \textcolor{keywordtype}{byte}\ *responseBuffer;}
\DoxyCodeLine{00658\ \ \ \ \ \textcolor{keywordtype}{byte}\ responseLength;}
\DoxyCodeLine{00659\ \ \ \ \ }
\DoxyCodeLine{00660\ \ \ \ \ \textcolor{comment}{//\ Description\ of\ buffer\ structure:}}
\DoxyCodeLine{00661\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 0:\ SEL\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Indicates\ the\ Cascade\ Level:\ PICC\_CMD\_SEL\_CL1,\ PICC\_CMD\_SEL\_CL2\ or\ PICC\_CMD\_SEL\_CL3}}
\DoxyCodeLine{00662\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 1:\ NVB\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Number\ of\ Valid\ Bits\ (in\ complete\ command,\ not\ just\ the\ UID):\ High\ nibble:\ complete\ bytes,\ Low\ nibble:\ Extra\ bits.\ }}
\DoxyCodeLine{00663\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 2:\ UID-\/data\ or\ CT\ \ \ \ \ \ See\ explanation\ below.\ CT\ means\ Cascade\ Tag.}}
\DoxyCodeLine{00664\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 3:\ UID-\/data}}
\DoxyCodeLine{00665\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 4:\ UID-\/data}}
\DoxyCodeLine{00666\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 5:\ UID-\/data}}
\DoxyCodeLine{00667\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 6:\ BCC\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Block\ Check\ Character\ -\/\ XOR\ of\ bytes\ 2-\/5}}
\DoxyCodeLine{00668\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 7:\ CRC\_A}}
\DoxyCodeLine{00669\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Byte\ 8:\ CRC\_A}}
\DoxyCodeLine{00670\ \ \ \ \ \textcolor{comment}{//\ The\ BCC\ and\ CRC\_A\ are\ only\ transmitted\ if\ we\ know\ all\ the\ UID\ bits\ of\ the\ current\ Cascade\ Level.}}
\DoxyCodeLine{00671\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00672\ \ \ \ \ \textcolor{comment}{//\ Description\ of\ bytes\ 2-\/5:\ (Section\ 6.5.4\ of\ the\ ISO/IEC\ 14443-\/3\ draft:\ UID\ contents\ and\ cascade\ levels)}}
\DoxyCodeLine{00673\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ UID\ size\ \ \ \ Cascade\ level\ \ \ Byte2\ \ \ Byte3\ \ \ Byte4\ \ \ Byte5}}
\DoxyCodeLine{00674\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ ========\ \ \ \ =============\ \ \ =====\ \ \ =====\ \ \ =====\ \ \ =====}}
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ 4\ bytes\ \ \ \ \ \ \ \ 1\ \ \ \ \ \ \ \ \ \ \ uid0\ \ \ \ uid1\ \ \ \ uid2\ \ \ \ uid3}}
\DoxyCodeLine{00676\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ 7\ bytes\ \ \ \ \ \ \ \ 1\ \ \ \ \ \ \ \ \ \ \ CT\ \ \ \ \ \ uid0\ \ \ \ uid1\ \ \ \ uid2}}
\DoxyCodeLine{00677\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 2\ \ \ \ \ \ \ \ \ \ \ uid3\ \ \ \ uid4\ \ \ \ uid5\ \ \ \ uid6}}
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ 10\ bytes\ \ \ \ \ \ \ \ 1\ \ \ \ \ \ \ \ \ \ \ CT\ \ \ \ \ \ uid0\ \ \ \ uid1\ \ \ \ uid2}}
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 2\ \ \ \ \ \ \ \ \ \ \ CT\ \ \ \ \ \ uid3\ \ \ \ uid4\ \ \ \ uid5}}
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 3\ \ \ \ \ \ \ \ \ \ \ uid6\ \ \ \ uid7\ \ \ \ uid8\ \ \ \ uid9}}
\DoxyCodeLine{00681\ \ \ \ \ }
\DoxyCodeLine{00682\ \ \ \ \ \textcolor{comment}{//\ Sanity\ checks}}
\DoxyCodeLine{00683\ \ \ \ \ \textcolor{keywordflow}{if}\ (validBits\ >\ 80)\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_INVALID;}
\DoxyCodeLine{00685\ \ \ \ \ \}}
\DoxyCodeLine{00686\ \ \ \ \ }
\DoxyCodeLine{00687\ \ \ \ \ \textcolor{comment}{//\ Prepare\ MFRC522}}
\DoxyCodeLine{00688\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a76193f4f8916f688fe2b7976d0fd1dc2}{PCD\_ClearRegisterBitMask}}(CollReg,\ 0x80);\ \ \ \ \ \ \ \ \textcolor{comment}{//\ ValuesAfterColl=1\ =>\ Bits\ received\ after\ collision\ are\ cleared.}}
\DoxyCodeLine{00689\ \ \ \ \ }
\DoxyCodeLine{00690\ \ \ \ \ \textcolor{comment}{//\ Repeat\ Cascade\ Level\ loop\ until\ we\ have\ a\ complete\ UID.}}
\DoxyCodeLine{00691\ \ \ \ \ uidComplete\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00692\ \ \ \ \ \textcolor{keywordflow}{while}\ (!uidComplete)\ \{}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ the\ Cascade\ Level\ in\ the\ SEL\ byte,\ find\ out\ if\ we\ need\ to\ use\ the\ Cascade\ Tag\ in\ byte\ 2.}}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (cascadeLevel)\ \{}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer[0]\ =\ PICC\_CMD\_SEL\_CL1;}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uidIndex\ =\ 0;}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ useCascadeTag\ =\ validBits\ \&\&\ uid-\/>size\ >\ 4;\ \textcolor{comment}{//\ When\ we\ know\ that\ the\ UID\ has\ more\ than\ 4\ bytes}}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer[0]\ =\ PICC\_CMD\_SEL\_CL2;}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uidIndex\ =\ 3;}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ useCascadeTag\ =\ validBits\ \&\&\ uid-\/>size\ >\ 7;\ \textcolor{comment}{//\ When\ we\ know\ that\ the\ UID\ has\ more\ than\ 7\ bytes}}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 3:}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer[0]\ =\ PICC\_CMD\_SEL\_CL3;}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uidIndex\ =\ 6;}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ useCascadeTag\ =\ \textcolor{keyword}{false};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Never\ used\ in\ CL3.}}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_INTERNAL\_ERROR;}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ How\ many\ UID\ bits\ are\ known\ in\ this\ Cascade\ Level?}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ currentLevelKnownBits\ =\ validBits\ -\/\ (8\ *\ uidIndex);}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (currentLevelKnownBits\ <\ 0)\ \{}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ currentLevelKnownBits\ =\ 0;}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ known\ bits\ from\ uid-\/>uidByte[]\ to\ buffer[]}}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ index\ =\ 2;\ \textcolor{comment}{//\ destination\ index\ in\ buffer[]}}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (useCascadeTag)\ \{}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ buffer[index++]\ =\ PICC\_CMD\_CT;}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ bytesToCopy\ =\ currentLevelKnownBits\ /\ 8\ +\ (currentLevelKnownBits\ \%\ 8\ ?\ 1\ :\ 0);\ \textcolor{comment}{//\ The\ number\ of\ bytes\ needed\ to\ represent\ the\ known\ bits\ for\ this\ level.}}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesToCopy)\ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ maxBytes\ =\ useCascadeTag\ ?\ 3\ :\ 4;\ \textcolor{comment}{//\ Max\ 4\ bytes\ in\ each\ Cascade\ Level.\ Only\ 3\ left\ if\ we\ use\ the\ Cascade\ Tag}}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesToCopy\ >\ maxBytes)\ \{}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bytesToCopy\ =\ maxBytes;}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (count\ =\ 0;\ count\ <\ bytesToCopy;\ count++)\ \{}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer[index++]\ =\ uid-\/>uidByte[uidIndex\ +\ count];}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ that\ the\ data\ has\ been\ copied\ we\ need\ to\ include\ the\ 8\ bits\ in\ CT\ in\ currentLevelKnownBits}}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (useCascadeTag)\ \{}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ currentLevelKnownBits\ +=\ 8;}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Repeat\ anti\ collision\ loop\ until\ we\ can\ transmit\ all\ UID\ bits\ +\ BCC\ and\ receive\ a\ SAK\ -\/\ max\ 32\ iterations.}}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ selectDone\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!selectDone)\ \{}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ out\ how\ many\ bits\ and\ bytes\ to\ send\ and\ receive.}}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (currentLevelKnownBits\ >=\ 32)\ \{\ \textcolor{comment}{//\ All\ UID\ bits\ in\ this\ Cascade\ Level\ are\ known.\ This\ is\ a\ SELECT.}}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Serial.print(F("{}SELECT:\ currentLevelKnownBits="{}));\ Serial.println(currentLevelKnownBits,\ DEC);}}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer[1]\ =\ 0x70;\ \textcolor{comment}{//\ NVB\ -\/\ Number\ of\ Valid\ Bits:\ Seven\ whole\ bytes}}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ BCC\ -\/\ Block\ Check\ Character}}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer[6]\ =\ buffer[2]\ \string^\ buffer[3]\ \string^\ buffer[4]\ \string^\ buffer[5];}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ CRC\_A}}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_a7c65647b1d72b6ee7557797322030643}{PCD\_CalculateCRC}}(buffer,\ 7,\ \&buffer[7]);}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ txLastBits\ \ \ \ \ \ =\ 0;\ \textcolor{comment}{//\ 0\ =>\ All\ 8\ bits\ are\ valid.}}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferUsed\ \ \ \ \ \ =\ 9;}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Store\ response\ in\ the\ last\ 3\ bytes\ of\ buffer\ (BCC\ and\ CRC\_A\ -\/\ not\ needed\ after\ tx)}}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ responseBuffer\ \ =\ \&buffer[6];}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ responseLength\ \ =\ 3;}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ This\ is\ an\ ANTICOLLISION.}}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Serial.print(F("{}ANTICOLLISION:\ currentLevelKnownBits="{}));\ Serial.println(currentLevelKnownBits,\ DEC);}}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ txLastBits\ \ \ \ \ \ =\ currentLevelKnownBits\ \%\ 8;}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ count\ \ \ \ \ \ \ \ \ \ \ =\ currentLevelKnownBits\ /\ 8;\ \ \ \ \textcolor{comment}{//\ Number\ of\ whole\ bytes\ in\ the\ UID\ part.}}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ index\ \ \ \ \ \ \ \ \ \ \ =\ 2\ +\ count;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ whole\ bytes:\ SEL\ +\ NVB\ +\ UIDs}}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer[1]\ \ \ \ \ \ \ =\ (index\ <<\ 4)\ +\ txLastBits;\ \ \ \ \textcolor{comment}{//\ NVB\ -\/\ Number\ of\ Valid\ Bits}}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferUsed\ \ \ \ \ \ =\ index\ +\ (txLastBits\ ?\ 1\ :\ 0);}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Store\ response\ in\ the\ unused\ part\ of\ buffer}}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ responseBuffer\ \ =\ \&buffer[index];}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ responseLength\ \ =\ \textcolor{keyword}{sizeof}(buffer)\ -\/\ index;}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ bit\ adjustments}}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ \ rxAlign\ =\ txLastBits;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Having\ a\ separate\ variable\ is\ overkill.\ But\ it\ makes\ the\ next\ line\ easier\ to\ read.}}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(BitFramingReg,\ (rxAlign\ <<\ 4)\ +\ txLastBits);\ \textcolor{comment}{//\ RxAlign\ =\ BitFramingReg[6..4].\ TxLastBits\ =\ BitFramingReg[2..0]}}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transmit\ the\ buffer\ and\ receive\ the\ response.}}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_aaa96aa7ec4f95e0835cb758ad0450d74}{PCD\_TransceiveData}}(buffer,\ bufferUsed,\ responseBuffer,\ \&responseLength,\ \&txLastBits,\ rxAlign);}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ STATUS\_COLLISION)\ \{\ \textcolor{comment}{//\ More\ than\ one\ PICC\ in\ the\ field\ =>\ collision.}}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ valueOfCollReg\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(CollReg);\ \textcolor{comment}{//\ CollReg[7..0]\ bits\ are:\ ValuesAfterColl\ reserved\ CollPosNotValid\ CollPos[4:0]}}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (valueOfCollReg\ \&\ 0x20)\ \{\ \textcolor{comment}{//\ CollPosNotValid}}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_COLLISION;\ \textcolor{comment}{//\ Without\ a\ valid\ collision\ position\ we\ cannot\ continue}}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ collisionPos\ =\ valueOfCollReg\ \&\ 0x1F;\ \textcolor{comment}{//\ Values\ 0-\/31,\ 0\ means\ bit\ 32.}}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collisionPos\ ==\ 0)\ \{}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collisionPos\ =\ 32;}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collisionPos\ <=\ currentLevelKnownBits)\ \{\ \textcolor{comment}{//\ No\ progress\ -\/\ should\ not\ happen\ }}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_INTERNAL\_ERROR;}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Choose\ the\ PICC\ with\ the\ bit\ set.}}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentLevelKnownBits\ \ \ =\ collisionPos;}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ count\ \ \ \ \ \ \ \ \ \ \ =\ currentLevelKnownBits\ \%\ 8;\ \textcolor{comment}{//\ The\ bit\ to\ modify}}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ checkBit\ \ \ \ \ \ \ \ =\ (currentLevelKnownBits\ -\/\ 1)\ \%\ 8;}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ index\ \ \ \ \ \ \ \ \ \ \ =\ 1\ +\ (currentLevelKnownBits\ /\ 8)\ +\ (count\ ?\ 1\ :\ 0);\ \textcolor{comment}{//\ First\ byte\ is\ index\ 0.}}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffer[index]\ \ \ |=\ (1\ <<\ checkBit);}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ STATUS\_OK}}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (currentLevelKnownBits\ >=\ 32)\ \{\ \textcolor{comment}{//\ This\ was\ a\ SELECT.}}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ selectDone\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ No\ more\ anticollision\ }}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ continue\ below\ outside\ the\ while.}}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ This\ was\ an\ ANTICOLLISION.}}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ now\ have\ all\ 32\ bits\ of\ the\ UID\ in\ this\ Cascade\ Level}}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ currentLevelKnownBits\ =\ 32;}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Run\ loop\ again\ to\ do\ the\ SELECT.}}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ End\ of\ while\ (!selectDone)}}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ do\ not\ check\ the\ CBB\ -\/\ it\ was\ constructed\ by\ us\ above.}}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ found\ UID\ bytes\ from\ buffer[]\ to\ uid-\/>uidByte[]}}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ index\ \ \ \ \ \ \ \ \ \ \ =\ (buffer[2]\ ==\ PICC\_CMD\_CT)\ ?\ 3\ :\ 2;\ \textcolor{comment}{//\ source\ index\ in\ buffer[]}}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ bytesToCopy\ \ \ \ \ =\ (buffer[2]\ ==\ PICC\_CMD\_CT)\ ?\ 3\ :\ 4;}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (count\ =\ 0;\ count\ <\ bytesToCopy;\ count++)\ \{}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \ \ \ \ uid-\/>uidByte[uidIndex\ +\ count]\ =\ buffer[index++];}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ response\ SAK\ (Select\ Acknowledge)}}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (responseLength\ !=\ 3\ ||\ txLastBits\ !=\ 0)\ \{\ \textcolor{comment}{//\ SAK\ must\ be\ exactly\ 24\ bits\ (1\ byte\ +\ CRC\_A).}}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_ERROR;}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verify\ CRC\_A\ -\/\ do\ our\ own\ calculation\ and\ store\ the\ control\ in\ buffer[2..3]\ -\/\ those\ bytes\ are\ not\ needed\ anymore.}}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_a7c65647b1d72b6ee7557797322030643}{PCD\_CalculateCRC}}(responseBuffer,\ 1,\ \&buffer[2]);}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((buffer[2]\ !=\ responseBuffer[1])\ ||\ (buffer[3]\ !=\ responseBuffer[2]))\ \{}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_CRC\_WRONG;}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (responseBuffer[0]\ \&\ 0x04)\ \{\ \textcolor{comment}{//\ Cascade\ bit\ set\ -\/\ UID\ not\ complete\ yes}}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \ \ \ \ cascadeLevel++;}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ \ \ uidComplete\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \ \ \ \ uid-\/>sak\ =\ responseBuffer[0];}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00844\ \ \ \ \ \}\ \textcolor{comment}{//\ End\ of\ while\ (!uidComplete)}}
\DoxyCodeLine{00845\ \ \ \ \ }
\DoxyCodeLine{00846\ \ \ \ \ \textcolor{comment}{//\ Set\ correct\ uid-\/>size}}
\DoxyCodeLine{00847\ \ \ \ \ uid-\/>size\ =\ 3\ *\ cascadeLevel\ +\ 1;}
\DoxyCodeLine{00848\ }
\DoxyCodeLine{00849\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{00850\ \}\ \textcolor{comment}{//\ End\ PICC\_Select()}}
\DoxyCodeLine{00851\ }
\DoxyCodeLine{00857\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a8874921b4ed26c5b73d89c90f76d4933}{MFRC522::PICC\_HaltA}}()\ \{}
\DoxyCodeLine{00858\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{00859\ \ \ \ \ \textcolor{keywordtype}{byte}\ buffer[4];}
\DoxyCodeLine{00860\ \ \ \ \ }
\DoxyCodeLine{00861\ \ \ \ \ \textcolor{comment}{//\ Build\ command\ buffer}}
\DoxyCodeLine{00862\ \ \ \ \ buffer[0]\ =\ PICC\_CMD\_HLTA;}
\DoxyCodeLine{00863\ \ \ \ \ buffer[1]\ =\ 0;}
\DoxyCodeLine{00864\ \ \ \ \ \textcolor{comment}{//\ Calculate\ CRC\_A}}
\DoxyCodeLine{00865\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_a7c65647b1d72b6ee7557797322030643}{PCD\_CalculateCRC}}(buffer,\ 2,\ \&buffer[2]);}
\DoxyCodeLine{00866\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00868\ \ \ \ \ \}}
\DoxyCodeLine{00869\ \ \ \ \ }
\DoxyCodeLine{00870\ \ \ \ \ \textcolor{comment}{//\ Send\ the\ command.}}
\DoxyCodeLine{00871\ \ \ \ \ \textcolor{comment}{//\ The\ standard\ says:}}
\DoxyCodeLine{00872\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ If\ the\ PICC\ responds\ with\ any\ modulation\ during\ a\ period\ of\ 1\ ms\ after\ the\ end\ of\ the\ frame\ containing\ the}}
\DoxyCodeLine{00873\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ HLTA\ command,\ this\ response\ shall\ be\ interpreted\ as\ 'not\ acknowledge'.}}
\DoxyCodeLine{00874\ \ \ \ \ \textcolor{comment}{//\ We\ interpret\ that\ this\ way:\ Only\ STATUS\_TIMEOUT\ is\ a\ success.}}
\DoxyCodeLine{00875\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_aaa96aa7ec4f95e0835cb758ad0450d74}{PCD\_TransceiveData}}(buffer,\ \textcolor{keyword}{sizeof}(buffer),\ \textcolor{keyword}{nullptr},\ 0);}
\DoxyCodeLine{00876\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ STATUS\_TIMEOUT)\ \{}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{00878\ \ \ \ \ \}}
\DoxyCodeLine{00879\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ STATUS\_OK)\ \{\ \textcolor{comment}{//\ That\ is\ ironically\ NOT\ ok\ in\ this\ case\ ;-\/)}}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_ERROR;}
\DoxyCodeLine{00881\ \ \ \ \ \}}
\DoxyCodeLine{00882\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00883\ \}\ \textcolor{comment}{//\ End\ PICC\_HaltA()}}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00886\ \textcolor{comment}{//\ Functions\ for\ communicating\ with\ MIFARE\ PICCs}}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00901\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a6c2313c4aa98806cc2bf0e9cca993ec0}{MFRC522::PCD\_Authenticate}}(\textcolor{keywordtype}{byte}\ command,\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ blockAddr,\ \ \ \ \ }
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_structMFRC522_1_1MIFARE__Key}{MIFARE\_Key}}\ *key,\ \ }
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_structMFRC522_1_1Uid}{Uid}}\ *uid\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00906\ \ \ \ \ \textcolor{keywordtype}{byte}\ waitIRq\ =\ 0x10;\ \ \ \ \ \ \ \ \textcolor{comment}{//\ IdleIRq}}
\DoxyCodeLine{00907\ \ \ \ \ }
\DoxyCodeLine{00908\ \ \ \ \ \textcolor{comment}{//\ Build\ command\ buffer}}
\DoxyCodeLine{00909\ \ \ \ \ \textcolor{keywordtype}{byte}\ sendData[12];}
\DoxyCodeLine{00910\ \ \ \ \ sendData[0]\ =\ command;}
\DoxyCodeLine{00911\ \ \ \ \ sendData[1]\ =\ blockAddr;}
\DoxyCodeLine{00912\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ i\ =\ 0;\ i\ <\ MF\_KEY\_SIZE;\ i++)\ \{\ \ \ \ \textcolor{comment}{//\ 6\ key\ bytes}}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ sendData[2+i]\ =\ key-\/>keyByte[i];}
\DoxyCodeLine{00914\ \ \ \ \ \}}
\DoxyCodeLine{00915\ \ \ \ \ \textcolor{comment}{//\ Use\ the\ last\ uid\ bytes\ as\ specified\ in\ http://cache.nxp.com/documents/application\_note/AN10927.pdf}}
\DoxyCodeLine{00916\ \ \ \ \ \textcolor{comment}{//\ section\ 3.2.5\ "{}MIFARE\ Classic\ Authentication"{}.}}
\DoxyCodeLine{00917\ \ \ \ \ \textcolor{comment}{//\ The\ only\ missed\ case\ is\ the\ MF1Sxxxx\ shortcut\ activation,}}
\DoxyCodeLine{00918\ \ \ \ \ \textcolor{comment}{//\ but\ it\ requires\ cascade\ tag\ (CT)\ byte,\ that\ is\ not\ part\ of\ uid.}}
\DoxyCodeLine{00919\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ last\ 4\ bytes\ of\ the\ UID}}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ sendData[8+i]\ =\ uid-\/>uidByte[i+uid-\/>size-\/4];}
\DoxyCodeLine{00921\ \ \ \ \ \}}
\DoxyCodeLine{00922\ \ \ \ \ }
\DoxyCodeLine{00923\ \ \ \ \ \textcolor{comment}{//\ Start\ the\ authentication.}}
\DoxyCodeLine{00924\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_acb2b1e74bc49fda2704450a684faa845}{PCD\_CommunicateWithPICC}}(PCD\_MFAuthent,\ waitIRq,\ \&sendData[0],\ \textcolor{keyword}{sizeof}(sendData));}
\DoxyCodeLine{00925\ \}\ \textcolor{comment}{//\ End\ PCD\_Authenticate()}}
\DoxyCodeLine{00926\ }
\DoxyCodeLine{00931\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a24d3ab7b2170fdfa3f0121a7256f12d9}{MFRC522::PCD\_StopCrypto1}}()\ \{}
\DoxyCodeLine{00932\ \ \ \ \ \textcolor{comment}{//\ Clear\ MFCrypto1On\ bit}}
\DoxyCodeLine{00933\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a76193f4f8916f688fe2b7976d0fd1dc2}{PCD\_ClearRegisterBitMask}}(Status2Reg,\ 0x08);\ \textcolor{comment}{//\ Status2Reg[7..0]\ bits\ are:\ TempSensClear\ I2CForceHS\ reserved\ reserved\ MFCrypto1On\ ModemState[2:0]}}
\DoxyCodeLine{00934\ \}\ \textcolor{comment}{//\ End\ PCD\_StopCrypto1()}}
\DoxyCodeLine{00935\ }
\DoxyCodeLine{00952\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a6ed93e88913ea104420f3bb4a88cce52}{MFRC522::MIFARE\_Read}}(\ \ \ \textcolor{keywordtype}{byte}\ blockAddr,\ \ \ \ \ }
\DoxyCodeLine{00953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *buffer,\ \ \ \ \ \ \ }
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *bufferSize\ \ \ \ }
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00956\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{00957\ \ \ \ \ }
\DoxyCodeLine{00958\ \ \ \ \ \textcolor{comment}{//\ Sanity\ check}}
\DoxyCodeLine{00959\ \ \ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ \textcolor{keyword}{nullptr}\ ||\ *bufferSize\ <\ 18)\ \{}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_NO\_ROOM;}
\DoxyCodeLine{00961\ \ \ \ \ \}}
\DoxyCodeLine{00962\ \ \ \ \ }
\DoxyCodeLine{00963\ \ \ \ \ \textcolor{comment}{//\ Build\ command\ buffer}}
\DoxyCodeLine{00964\ \ \ \ \ buffer[0]\ =\ PICC\_CMD\_MF\_READ;}
\DoxyCodeLine{00965\ \ \ \ \ buffer[1]\ =\ blockAddr;}
\DoxyCodeLine{00966\ \ \ \ \ \textcolor{comment}{//\ Calculate\ CRC\_A}}
\DoxyCodeLine{00967\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_a7c65647b1d72b6ee7557797322030643}{PCD\_CalculateCRC}}(buffer,\ 2,\ \&buffer[2]);}
\DoxyCodeLine{00968\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00970\ \ \ \ \ \}}
\DoxyCodeLine{00971\ \ \ \ \ }
\DoxyCodeLine{00972\ \ \ \ \ \textcolor{comment}{//\ Transmit\ the\ buffer\ and\ receive\ the\ response,\ validate\ CRC\_A.}}
\DoxyCodeLine{00973\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_aaa96aa7ec4f95e0835cb758ad0450d74}{PCD\_TransceiveData}}(buffer,\ 4,\ buffer,\ bufferSize,\ \textcolor{keyword}{nullptr},\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00974\ \}\ \textcolor{comment}{//\ End\ MIFARE\_Read()}}
\DoxyCodeLine{00975\ }
\DoxyCodeLine{00987\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a0dc5fb05769779ec3ed708bd153706b3}{MFRC522::MIFARE\_Write}}(\ \textcolor{keywordtype}{byte}\ blockAddr,\ }
\DoxyCodeLine{00988\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *buffer,\ \ \ }
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ bufferSize\ }
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00991\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{00992\ \ \ \ \ }
\DoxyCodeLine{00993\ \ \ \ \ \textcolor{comment}{//\ Sanity\ check}}
\DoxyCodeLine{00994\ \ \ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ \textcolor{keyword}{nullptr}\ ||\ bufferSize\ <\ 16)\ \{}
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_INVALID;}
\DoxyCodeLine{00996\ \ \ \ \ \}}
\DoxyCodeLine{00997\ \ \ \ \ }
\DoxyCodeLine{00998\ \ \ \ \ \textcolor{comment}{//\ Mifare\ Classic\ protocol\ requires\ two\ communications\ to\ perform\ a\ write.}}
\DoxyCodeLine{00999\ \ \ \ \ \textcolor{comment}{//\ Step\ 1:\ Tell\ the\ PICC\ we\ want\ to\ write\ to\ block\ blockAddr.}}
\DoxyCodeLine{01000\ \ \ \ \ \textcolor{keywordtype}{byte}\ cmdBuffer[2];}
\DoxyCodeLine{01001\ \ \ \ \ cmdBuffer[0]\ =\ PICC\_CMD\_MF\_WRITE;}
\DoxyCodeLine{01002\ \ \ \ \ cmdBuffer[1]\ =\ blockAddr;}
\DoxyCodeLine{01003\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_aa88d28676b3ffb5985af8db35d39077b}{PCD\_MIFARE\_Transceive}}(cmdBuffer,\ 2);\ \textcolor{comment}{//\ Adds\ CRC\_A\ and\ checks\ that\ the\ response\ is\ MF\_ACK.}}
\DoxyCodeLine{01004\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01006\ \ \ \ \ \}}
\DoxyCodeLine{01007\ \ \ \ \ }
\DoxyCodeLine{01008\ \ \ \ \ \textcolor{comment}{//\ Step\ 2:\ Transfer\ the\ data}}
\DoxyCodeLine{01009\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_aa88d28676b3ffb5985af8db35d39077b}{PCD\_MIFARE\_Transceive}}(buffer,\ bufferSize);\ \textcolor{comment}{//\ Adds\ CRC\_A\ and\ checks\ that\ the\ response\ is\ MF\_ACK.}}
\DoxyCodeLine{01010\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01012\ \ \ \ \ \}}
\DoxyCodeLine{01013\ \ \ \ \ }
\DoxyCodeLine{01014\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{01015\ \}\ \textcolor{comment}{//\ End\ MIFARE\_Write()}}
\DoxyCodeLine{01016\ }
\DoxyCodeLine{01022\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a7053e61540b68e6aa5c6cbea308836c4}{MFRC522::MIFARE\_Ultralight\_Write}}(\ \ \ \textcolor{keywordtype}{byte}\ page,\ \ \ \ \ \ }
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ *buffer,\ \ \ }
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ bufferSize\ }
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01026\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{01027\ \ \ \ \ }
\DoxyCodeLine{01028\ \ \ \ \ \textcolor{comment}{//\ Sanity\ check}}
\DoxyCodeLine{01029\ \ \ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ \textcolor{keyword}{nullptr}\ ||\ bufferSize\ <\ 4)\ \{}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_INVALID;}
\DoxyCodeLine{01031\ \ \ \ \ \}}
\DoxyCodeLine{01032\ \ \ \ \ }
\DoxyCodeLine{01033\ \ \ \ \ \textcolor{comment}{//\ Build\ commmand\ buffer}}
\DoxyCodeLine{01034\ \ \ \ \ \textcolor{keywordtype}{byte}\ cmdBuffer[6];}
\DoxyCodeLine{01035\ \ \ \ \ cmdBuffer[0]\ =\ PICC\_CMD\_UL\_WRITE;}
\DoxyCodeLine{01036\ \ \ \ \ cmdBuffer[1]\ =\ page;}
\DoxyCodeLine{01037\ \ \ \ \ memcpy(\&cmdBuffer[2],\ buffer,\ 4);}
\DoxyCodeLine{01038\ \ \ \ \ }
\DoxyCodeLine{01039\ \ \ \ \ \textcolor{comment}{//\ Perform\ the\ write}}
\DoxyCodeLine{01040\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_aa88d28676b3ffb5985af8db35d39077b}{PCD\_MIFARE\_Transceive}}(cmdBuffer,\ 6);\ \textcolor{comment}{//\ Adds\ CRC\_A\ and\ checks\ that\ the\ response\ is\ MF\_ACK.}}
\DoxyCodeLine{01041\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01043\ \ \ \ \ \}}
\DoxyCodeLine{01044\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{01045\ \}\ \textcolor{comment}{//\ End\ MIFARE\_Ultralight\_Write()}}
\DoxyCodeLine{01046\ }
\DoxyCodeLine{01055\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_aeab21496c761cdecb29c69f9f3fa6150}{MFRC522::MIFARE\_Decrement}}(\ \textcolor{keywordtype}{byte}\ blockAddr,\ }
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ delta\ \ \ \ \ \ \ }
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01058\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_a86cb4ad38f61b823dfe97103b1b1f9d6}{MIFARE\_TwoStepHelper}}(PICC\_CMD\_MF\_DECREMENT,\ blockAddr,\ delta);}
\DoxyCodeLine{01059\ \}\ \textcolor{comment}{//\ End\ MIFARE\_Decrement()}}
\DoxyCodeLine{01060\ }
\DoxyCodeLine{01069\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_af9566664f23d4d67efd270e42c3dc723}{MFRC522::MIFARE\_Increment}}(\ \textcolor{keywordtype}{byte}\ blockAddr,\ }
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ delta\ \ \ \ \ \ \ }
\DoxyCodeLine{01071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01072\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_a86cb4ad38f61b823dfe97103b1b1f9d6}{MIFARE\_TwoStepHelper}}(PICC\_CMD\_MF\_INCREMENT,\ blockAddr,\ delta);}
\DoxyCodeLine{01073\ \}\ \textcolor{comment}{//\ End\ MIFARE\_Increment()}}
\DoxyCodeLine{01074\ }
\DoxyCodeLine{01083\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a946ba7e7e244f40adcb9f900d8fd3a48}{MFRC522::MIFARE\_Restore}}(\ \textcolor{keywordtype}{byte}\ blockAddr\ }
\DoxyCodeLine{01084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01085\ \ \ \ \ \textcolor{comment}{//\ The\ datasheet\ describes\ Restore\ as\ a\ two\ step\ operation,\ but\ does\ not\ explain\ what\ data\ to\ transfer\ in\ step\ 2.}}
\DoxyCodeLine{01086\ \ \ \ \ \textcolor{comment}{//\ Doing\ only\ a\ single\ step\ does\ not\ work,\ so\ I\ chose\ to\ transfer\ 0L\ in\ step\ two.}}
\DoxyCodeLine{01087\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_a86cb4ad38f61b823dfe97103b1b1f9d6}{MIFARE\_TwoStepHelper}}(PICC\_CMD\_MF\_RESTORE,\ blockAddr,\ 0L);}
\DoxyCodeLine{01088\ \}\ \textcolor{comment}{//\ End\ MIFARE\_Restore()}}
\DoxyCodeLine{01089\ }
\DoxyCodeLine{01095\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a86cb4ad38f61b823dfe97103b1b1f9d6}{MFRC522::MIFARE\_TwoStepHelper}}(\ \textcolor{keywordtype}{byte}\ command,\ \ \ }
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ blockAddr,\ }
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ data\ \ \ \ \ \ \ \ }
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01099\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{01100\ \ \ \ \ \textcolor{keywordtype}{byte}\ cmdBuffer[2];\ \textcolor{comment}{//\ We\ only\ need\ room\ for\ 2\ bytes.}}
\DoxyCodeLine{01101\ \ \ \ \ }
\DoxyCodeLine{01102\ \ \ \ \ \textcolor{comment}{//\ Step\ 1:\ Tell\ the\ PICC\ the\ command\ and\ block\ address}}
\DoxyCodeLine{01103\ \ \ \ \ cmdBuffer[0]\ =\ command;}
\DoxyCodeLine{01104\ \ \ \ \ cmdBuffer[1]\ =\ blockAddr;}
\DoxyCodeLine{01105\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_aa88d28676b3ffb5985af8db35d39077b}{PCD\_MIFARE\_Transceive}}(\ \ \ \ cmdBuffer,\ 2);\ \textcolor{comment}{//\ Adds\ CRC\_A\ and\ checks\ that\ the\ response\ is\ MF\_ACK.}}
\DoxyCodeLine{01106\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01108\ \ \ \ \ \}}
\DoxyCodeLine{01109\ \ \ \ \ }
\DoxyCodeLine{01110\ \ \ \ \ \textcolor{comment}{//\ Step\ 2:\ Transfer\ the\ data}}
\DoxyCodeLine{01111\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_aa88d28676b3ffb5985af8db35d39077b}{PCD\_MIFARE\_Transceive}}(\ \ \ \ (\textcolor{keywordtype}{byte}\ *)\&data,\ 4,\ \textcolor{keyword}{true});\ \textcolor{comment}{//\ Adds\ CRC\_A\ and\ accept\ timeout\ as\ success.}}
\DoxyCodeLine{01112\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01114\ \ \ \ \ \}}
\DoxyCodeLine{01115\ \ \ \ \ }
\DoxyCodeLine{01116\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{01117\ \}\ \textcolor{comment}{//\ End\ MIFARE\_TwoStepHelper()}}
\DoxyCodeLine{01118\ }
\DoxyCodeLine{01126\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_a16ee66df69fda8a3065bc9218b45de0b}{MFRC522::MIFARE\_Transfer}}(\ \ \ \textcolor{keywordtype}{byte}\ blockAddr\ }
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01128\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{01129\ \ \ \ \ \textcolor{keywordtype}{byte}\ cmdBuffer[2];\ \textcolor{comment}{//\ We\ only\ need\ room\ for\ 2\ bytes.}}
\DoxyCodeLine{01130\ \ \ \ \ }
\DoxyCodeLine{01131\ \ \ \ \ \textcolor{comment}{//\ Tell\ the\ PICC\ we\ want\ to\ transfer\ the\ result\ into\ block\ blockAddr.}}
\DoxyCodeLine{01132\ \ \ \ \ cmdBuffer[0]\ =\ PICC\_CMD\_MF\_TRANSFER;}
\DoxyCodeLine{01133\ \ \ \ \ cmdBuffer[1]\ =\ blockAddr;}
\DoxyCodeLine{01134\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_aa88d28676b3ffb5985af8db35d39077b}{PCD\_MIFARE\_Transceive}}(\ \ \ \ cmdBuffer,\ 2);\ \textcolor{comment}{//\ Adds\ CRC\_A\ and\ checks\ that\ the\ response\ is\ MF\_ACK.}}
\DoxyCodeLine{01135\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01137\ \ \ \ \ \}}
\DoxyCodeLine{01138\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{01139\ \}\ \textcolor{comment}{//\ End\ MIFARE\_Transfer()}}
\DoxyCodeLine{01140\ }
\DoxyCodeLine{01152\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_ab4009cbdd5150b1b3a62084aa2033807}{MFRC522::MIFARE\_GetValue}}(\textcolor{keywordtype}{byte}\ blockAddr,\ int32\_t\ *value)\ \{}
\DoxyCodeLine{01153\ \ \ \ \ MFRC522::StatusCode\ status;}
\DoxyCodeLine{01154\ \ \ \ \ \textcolor{keywordtype}{byte}\ buffer[18];}
\DoxyCodeLine{01155\ \ \ \ \ \textcolor{keywordtype}{byte}\ size\ =\ \textcolor{keyword}{sizeof}(buffer);}
\DoxyCodeLine{01156\ \ \ \ \ }
\DoxyCodeLine{01157\ \ \ \ \ \textcolor{comment}{//\ Read\ the\ block}}
\DoxyCodeLine{01158\ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_a6ed93e88913ea104420f3bb4a88cce52}{MIFARE\_Read}}(blockAddr,\ buffer,\ \&size);}
\DoxyCodeLine{01159\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ ==\ STATUS\_OK)\ \{}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Extract\ the\ value}}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \ \ *value\ =\ (int32\_t(buffer[3])<<24)\ |\ (int32\_t(buffer[2])<<16)\ |\ (int32\_t(buffer[1])<<8)\ |\ int32\_t(buffer[0]);}
\DoxyCodeLine{01162\ \ \ \ \ \}}
\DoxyCodeLine{01163\ \ \ \ \ \textcolor{keywordflow}{return}\ status;}
\DoxyCodeLine{01164\ \}\ \textcolor{comment}{//\ End\ MIFARE\_GetValue()}}
\DoxyCodeLine{01165\ }
\DoxyCodeLine{01177\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_af19fc75e9415322fbe89245ed70a784b}{MFRC522::MIFARE\_SetValue}}(\textcolor{keywordtype}{byte}\ blockAddr,\ int32\_t\ value)\ \{}
\DoxyCodeLine{01178\ \ \ \ \ \textcolor{keywordtype}{byte}\ buffer[18];}
\DoxyCodeLine{01179\ \ \ \ \ }
\DoxyCodeLine{01180\ \ \ \ \ \textcolor{comment}{//\ Translate\ the\ int32\_t\ into\ 4\ bytes;\ repeated\ 2x\ in\ value\ block}}
\DoxyCodeLine{01181\ \ \ \ \ buffer[0]\ =\ buffer[\ 8]\ =\ (value\ \&\ 0xFF);}
\DoxyCodeLine{01182\ \ \ \ \ buffer[1]\ =\ buffer[\ 9]\ =\ (value\ \&\ 0xFF00)\ >>\ 8;}
\DoxyCodeLine{01183\ \ \ \ \ buffer[2]\ =\ buffer[10]\ =\ (value\ \&\ 0xFF0000)\ >>\ 16;}
\DoxyCodeLine{01184\ \ \ \ \ buffer[3]\ =\ buffer[11]\ =\ (value\ \&\ 0xFF000000)\ >>\ 24;}
\DoxyCodeLine{01185\ \ \ \ \ \textcolor{comment}{//\ Inverse\ 4\ bytes\ also\ found\ in\ value\ block}}
\DoxyCodeLine{01186\ \ \ \ \ buffer[4]\ =\ \string~buffer[0];}
\DoxyCodeLine{01187\ \ \ \ \ buffer[5]\ =\ \string~buffer[1];}
\DoxyCodeLine{01188\ \ \ \ \ buffer[6]\ =\ \string~buffer[2];}
\DoxyCodeLine{01189\ \ \ \ \ buffer[7]\ =\ \string~buffer[3];}
\DoxyCodeLine{01190\ \ \ \ \ \textcolor{comment}{//\ Address\ 2x\ with\ inverse\ address\ 2x}}
\DoxyCodeLine{01191\ \ \ \ \ buffer[12]\ =\ buffer[14]\ =\ blockAddr;}
\DoxyCodeLine{01192\ \ \ \ \ buffer[13]\ =\ buffer[15]\ =\ \string~blockAddr;}
\DoxyCodeLine{01193\ \ \ \ \ }
\DoxyCodeLine{01194\ \ \ \ \ \textcolor{comment}{//\ Write\ the\ whole\ data\ block}}
\DoxyCodeLine{01195\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMFRC522_a0dc5fb05769779ec3ed708bd153706b3}{MIFARE\_Write}}(blockAddr,\ buffer,\ 16);}
\DoxyCodeLine{01196\ \}\ \textcolor{comment}{//\ End\ MIFARE\_SetValue()}}
\DoxyCodeLine{01197\ }
\DoxyCodeLine{01207\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_acb47eb7a05ae58825b4085efeb7a09bb}{MFRC522::PCD\_NTAG216\_AUTH}}(\textcolor{keywordtype}{byte}*\ passWord,\ \textcolor{keywordtype}{byte}\ pACK[])\ \textcolor{comment}{//Authenticate\ with\ 32bit\ password}}
\DoxyCodeLine{01208\ \{}
\DoxyCodeLine{01209\ \ \ \ \ \textcolor{comment}{//\ TODO:\ Fix\ cmdBuffer\ length\ and\ rxlength.\ They\ really\ should\ match.}}
\DoxyCodeLine{01210\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ (Better\ still,\ rxlength\ should\ not\ even\ be\ necessary.)}}
\DoxyCodeLine{01211\ }
\DoxyCodeLine{01212\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{01213\ \ \ \ \ \textcolor{keywordtype}{byte}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmdBuffer[18];\ \textcolor{comment}{//\ We\ need\ room\ for\ 16\ bytes\ data\ and\ 2\ bytes\ CRC\_A.}}
\DoxyCodeLine{01214\ \ \ \ \ }
\DoxyCodeLine{01215\ \ \ \ \ cmdBuffer[0]\ =\ 0x1B;\ \textcolor{comment}{//Comando\ de\ autentificacion}}
\DoxyCodeLine{01216\ \ \ \ \ }
\DoxyCodeLine{01217\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ i\ =\ 0;\ i<4;\ i++)}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ cmdBuffer[i+1]\ =\ passWord[i];}
\DoxyCodeLine{01219\ \ \ \ \ }
\DoxyCodeLine{01220\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_a7c65647b1d72b6ee7557797322030643}{PCD\_CalculateCRC}}(cmdBuffer,\ 5,\ \&cmdBuffer[5]);}
\DoxyCodeLine{01221\ \ \ \ \ }
\DoxyCodeLine{01222\ \ \ \ \ \textcolor{keywordflow}{if}\ (result!=STATUS\_OK)\ \{}
\DoxyCodeLine{01223\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01224\ \ \ \ \ \}}
\DoxyCodeLine{01225\ \ \ \ \ }
\DoxyCodeLine{01226\ \ \ \ \ \textcolor{comment}{//\ Transceive\ the\ data,\ store\ the\ reply\ in\ cmdBuffer[]}}
\DoxyCodeLine{01227\ \ \ \ \ \textcolor{keywordtype}{byte}\ waitIRq\ \ \ \ \ \ \ \ =\ 0x30;\ \textcolor{comment}{//\ RxIRq\ and\ IdleIRq}}
\DoxyCodeLine{01228\ \textcolor{comment}{//\ \ byte\ cmdBufferSize\ \ =\ sizeof(cmdBuffer);}}
\DoxyCodeLine{01229\ \ \ \ \ \textcolor{keywordtype}{byte}\ validBits\ \ \ \ \ \ =\ 0;}
\DoxyCodeLine{01230\ \ \ \ \ \textcolor{keywordtype}{byte}\ rxlength\ \ \ \ \ \ \ =\ 5;}
\DoxyCodeLine{01231\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_acb2b1e74bc49fda2704450a684faa845}{PCD\_CommunicateWithPICC}}(PCD\_Transceive,\ waitIRq,\ cmdBuffer,\ 7,\ cmdBuffer,\ \&rxlength,\ \&validBits);}
\DoxyCodeLine{01232\ \ \ \ \ }
\DoxyCodeLine{01233\ \ \ \ \ pACK[0]\ =\ cmdBuffer[0];}
\DoxyCodeLine{01234\ \ \ \ \ pACK[1]\ =\ cmdBuffer[1];}
\DoxyCodeLine{01235\ \ \ \ \ }
\DoxyCodeLine{01236\ \ \ \ \ \textcolor{keywordflow}{if}\ (result!=STATUS\_OK)\ \{}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01238\ \ \ \ \ \}}
\DoxyCodeLine{01239\ \ \ \ \ }
\DoxyCodeLine{01240\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{01241\ \}\ \textcolor{comment}{//\ End\ PCD\_NTAG216\_AUTH()}}
\DoxyCodeLine{01242\ }
\DoxyCodeLine{01243\ }
\DoxyCodeLine{01245\ \textcolor{comment}{//\ Support\ functions}}
\DoxyCodeLine{01247\ }
\DoxyCodeLine{01254\ MFRC522::StatusCode\ \mbox{\hyperlink{classMFRC522_aa88d28676b3ffb5985af8db35d39077b}{MFRC522::PCD\_MIFARE\_Transceive}}(\ \ \ \textcolor{keywordtype}{byte}\ *sendData,\ \ \ \ \ }
\DoxyCodeLine{01255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ sendLen,\ \ \ \ \ \ \ }
\DoxyCodeLine{01256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ acceptTimeout\ \ }
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01258\ \ \ \ \ MFRC522::StatusCode\ result;}
\DoxyCodeLine{01259\ \ \ \ \ \textcolor{keywordtype}{byte}\ cmdBuffer[18];\ \textcolor{comment}{//\ We\ need\ room\ for\ 16\ bytes\ data\ and\ 2\ bytes\ CRC\_A.}}
\DoxyCodeLine{01260\ \ \ \ \ }
\DoxyCodeLine{01261\ \ \ \ \ \textcolor{comment}{//\ Sanity\ check}}
\DoxyCodeLine{01262\ \ \ \ \ \textcolor{keywordflow}{if}\ (sendData\ ==\ \textcolor{keyword}{nullptr}\ ||\ sendLen\ >\ 16)\ \{}
\DoxyCodeLine{01263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_INVALID;}
\DoxyCodeLine{01264\ \ \ \ \ \}}
\DoxyCodeLine{01265\ \ \ \ \ }
\DoxyCodeLine{01266\ \ \ \ \ \textcolor{comment}{//\ Copy\ sendData[]\ to\ cmdBuffer[]\ and\ add\ CRC\_A}}
\DoxyCodeLine{01267\ \ \ \ \ memcpy(cmdBuffer,\ sendData,\ sendLen);}
\DoxyCodeLine{01268\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_a7c65647b1d72b6ee7557797322030643}{PCD\_CalculateCRC}}(cmdBuffer,\ sendLen,\ \&cmdBuffer[sendLen]);}
\DoxyCodeLine{01269\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{\ }
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01271\ \ \ \ \ \}}
\DoxyCodeLine{01272\ \ \ \ \ sendLen\ +=\ 2;}
\DoxyCodeLine{01273\ \ \ \ \ }
\DoxyCodeLine{01274\ \ \ \ \ \textcolor{comment}{//\ Transceive\ the\ data,\ store\ the\ reply\ in\ cmdBuffer[]}}
\DoxyCodeLine{01275\ \ \ \ \ \textcolor{keywordtype}{byte}\ waitIRq\ =\ 0x30;\ \ \ \ \ \ \ \ \textcolor{comment}{//\ RxIRq\ and\ IdleIRq}}
\DoxyCodeLine{01276\ \ \ \ \ \textcolor{keywordtype}{byte}\ cmdBufferSize\ =\ \textcolor{keyword}{sizeof}(cmdBuffer);}
\DoxyCodeLine{01277\ \ \ \ \ \textcolor{keywordtype}{byte}\ validBits\ =\ 0;}
\DoxyCodeLine{01278\ \ \ \ \ result\ =\ \mbox{\hyperlink{classMFRC522_acb2b1e74bc49fda2704450a684faa845}{PCD\_CommunicateWithPICC}}(PCD\_Transceive,\ waitIRq,\ cmdBuffer,\ sendLen,\ cmdBuffer,\ \&cmdBufferSize,\ \&validBits);}
\DoxyCodeLine{01279\ \ \ \ \ \textcolor{keywordflow}{if}\ (acceptTimeout\ \&\&\ result\ ==\ STATUS\_TIMEOUT)\ \{}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{01281\ \ \ \ \ \}}
\DoxyCodeLine{01282\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{01284\ \ \ \ \ \}}
\DoxyCodeLine{01285\ \ \ \ \ \textcolor{comment}{//\ The\ PICC\ must\ reply\ with\ a\ 4\ bit\ ACK}}
\DoxyCodeLine{01286\ \ \ \ \ \textcolor{keywordflow}{if}\ (cmdBufferSize\ !=\ 1\ ||\ validBits\ !=\ 4)\ \{}
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_ERROR;}
\DoxyCodeLine{01288\ \ \ \ \ \}}
\DoxyCodeLine{01289\ \ \ \ \ \textcolor{keywordflow}{if}\ (cmdBuffer[0]\ !=\ MF\_ACK)\ \{}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_MIFARE\_NACK;}
\DoxyCodeLine{01291\ \ \ \ \ \}}
\DoxyCodeLine{01292\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{01293\ \}\ \textcolor{comment}{//\ End\ PCD\_MIFARE\_Transceive()}}
\DoxyCodeLine{01294\ }
\DoxyCodeLine{01300\ \textcolor{keyword}{const}\ \_\_FlashStringHelper\ *\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{MFRC522::GetStatusCodeName}}(MFRC522::StatusCode\ code\ \ \ \ }
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01302\ \ \ \ \ \textcolor{keywordflow}{switch}\ (code)\ \{}
\DoxyCodeLine{01303\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_OK:\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}Success."{}});}
\DoxyCodeLine{01304\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_ERROR:\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}Error\ in\ communication."{}});}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_COLLISION:\ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}Collision\ detected."{}});}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_TIMEOUT:\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}Timeout\ in\ communication."{}});}
\DoxyCodeLine{01307\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_NO\_ROOM:\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}A\ buffer\ is\ not\ big\ enough."{}});}
\DoxyCodeLine{01308\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_INTERNAL\_ERROR:\ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}Internal\ error\ in\ the\ code.\ Should\ not\ happen."{}});}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_INVALID:\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}Invalid\ argument."{}});}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_CRC\_WRONG:\ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}The\ CRC\_A\ does\ not\ match."{}});}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ STATUS\_MIFARE\_NACK:\ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}A\ MIFARE\ PICC\ responded\ with\ NAK."{}});}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}Unknown\ error"{}});}
\DoxyCodeLine{01313\ \ \ \ \ \}}
\DoxyCodeLine{01314\ \}\ \textcolor{comment}{//\ End\ GetStatusCodeName()}}
\DoxyCodeLine{01315\ }
\DoxyCodeLine{01321\ MFRC522::PICC\_Type\ \mbox{\hyperlink{classMFRC522_ac80a18228260bdde07dff5d4ac23bb53}{MFRC522::PICC\_GetType}}(\textcolor{keywordtype}{byte}\ sak\ \ \ \ \ \ }
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01323\ \ \ \ \ \textcolor{comment}{//\ http://www.nxp.com/documents/application\_note/AN10833.pdf\ }}
\DoxyCodeLine{01324\ \ \ \ \ \textcolor{comment}{//\ 3.2\ Coding\ of\ Select\ Acknowledge\ (SAK)}}
\DoxyCodeLine{01325\ \ \ \ \ \textcolor{comment}{//\ ignore\ 8-\/bit\ (iso14443\ starts\ with\ LSBit\ =\ bit\ 1)}}
\DoxyCodeLine{01326\ \ \ \ \ \textcolor{comment}{//\ fixes\ wrong\ type\ for\ manufacturer\ Infineon\ (http://nfc-\/tools.org/index.php?title=ISO14443A)}}
\DoxyCodeLine{01327\ \ \ \ \ sak\ \&=\ 0x7F;}
\DoxyCodeLine{01328\ \ \ \ \ \textcolor{keywordflow}{switch}\ (sak)\ \{}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x04:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_NOT\_COMPLETE;\ \ \textcolor{comment}{//\ UID\ not\ complete}}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x09:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_MIFARE\_MINI;}
\DoxyCodeLine{01331\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x08:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_MIFARE\_1K;}
\DoxyCodeLine{01332\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x18:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_MIFARE\_4K;}
\DoxyCodeLine{01333\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x00:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_MIFARE\_UL;}
\DoxyCodeLine{01334\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x10:}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x11:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_MIFARE\_PLUS;}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x01:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_TNP3XXX;}
\DoxyCodeLine{01337\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x20:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_ISO\_14443\_4;}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x40:\ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_ISO\_18092;}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \ \ \ \textcolor{keywordflow}{return}\ PICC\_TYPE\_UNKNOWN;}
\DoxyCodeLine{01340\ \ \ \ \ \}}
\DoxyCodeLine{01341\ \}\ \textcolor{comment}{//\ End\ PICC\_GetType()}}
\DoxyCodeLine{01342\ }
\DoxyCodeLine{01348\ \textcolor{keyword}{const}\ \_\_FlashStringHelper\ *\mbox{\hyperlink{classMFRC522_aae4a482352d4d4b7d7a9714b0b0b7c38}{MFRC522::PICC\_GetTypeName}}(PICC\_Type\ piccType\ \ \ \ }
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01350\ \ \ \ \ \textcolor{keywordflow}{switch}\ (piccType)\ \{}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_ISO\_14443\_4:\ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}PICC\ compliant\ with\ ISO/IEC\ 14443-\/4"{}});}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_ISO\_18092:\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}PICC\ compliant\ with\ ISO/IEC\ 18092\ (NFC)"{}});}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_MINI:\ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}MIFARE\ Mini,\ 320\ bytes"{}});}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_1K:\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}MIFARE\ 1KB"{}});}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_4K:\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}MIFARE\ 4KB"{}});}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_UL:\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}MIFARE\ Ultralight\ or\ Ultralight\ C"{}});}
\DoxyCodeLine{01357\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_PLUS:\ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}MIFARE\ Plus"{}});}
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_DESFIRE:\ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}MIFARE\ DESFire"{}});}
\DoxyCodeLine{01359\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_TNP3XXX:\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}MIFARE\ TNP3XXX"{}});}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_NOT\_COMPLETE:\ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}SAK\ indicates\ UID\ is\ not\ complete."{}});}
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_UNKNOWN:}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F(\textcolor{stringliteral}{"{}Unknown\ type"{}});}
\DoxyCodeLine{01363\ \ \ \ \ \}}
\DoxyCodeLine{01364\ \}\ \textcolor{comment}{//\ End\ PICC\_GetTypeName()}}
\DoxyCodeLine{01365\ }
\DoxyCodeLine{01370\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a41c31c6932a59646eeff470c60a4d20d}{MFRC522::PCD\_DumpVersionToSerial}}()\ \{}
\DoxyCodeLine{01371\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ MFRC522\ firmware\ version}}
\DoxyCodeLine{01372\ \ \ \ \ \textcolor{keywordtype}{byte}\ v\ =\ \mbox{\hyperlink{classMFRC522_a4289838c6f24f2d62eb8dc0e7a6647d1}{PCD\_ReadRegister}}(VersionReg);}
\DoxyCodeLine{01373\ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}Firmware\ Version:\ 0x"{}}));}
\DoxyCodeLine{01374\ \ \ \ \ Serial.print(v,\ HEX);}
\DoxyCodeLine{01375\ \ \ \ \ \textcolor{comment}{//\ Lookup\ which\ version}}
\DoxyCodeLine{01376\ \ \ \ \ \textcolor{keywordflow}{switch}(v)\ \{}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x88:\ Serial.println(F(\textcolor{stringliteral}{"{}\ =\ (clone)"{}}));\ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x90:\ Serial.println(F(\textcolor{stringliteral}{"{}\ =\ v0.0"{}}));\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x91:\ Serial.println(F(\textcolor{stringliteral}{"{}\ =\ v1.0"{}}));\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x92:\ Serial.println(F(\textcolor{stringliteral}{"{}\ =\ v2.0"{}}));\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0x12:\ Serial.println(F(\textcolor{stringliteral}{"{}\ =\ counterfeit\ chip"{}}));\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \ \ Serial.println(F(\textcolor{stringliteral}{"{}\ =\ (unknown)"{}}));}
\DoxyCodeLine{01383\ \ \ \ \ \}}
\DoxyCodeLine{01384\ \ \ \ \ \textcolor{comment}{//\ When\ 0x00\ or\ 0xFF\ is\ returned,\ communication\ probably\ failed}}
\DoxyCodeLine{01385\ \ \ \ \ \textcolor{keywordflow}{if}\ ((v\ ==\ 0x00)\ ||\ (v\ ==\ 0xFF))}
\DoxyCodeLine{01386\ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}WARNING:\ Communication\ failure,\ is\ the\ MFRC522\ properly\ connected?"{}}));}
\DoxyCodeLine{01387\ \}\ \textcolor{comment}{//\ End\ PCD\_DumpVersionToSerial()}}
\DoxyCodeLine{01388\ }
\DoxyCodeLine{01394\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a6f324d43c6fbbd0e260b171747186037}{MFRC522::PICC\_DumpToSerial}}(\mbox{\hyperlink{classMFRC522_structMFRC522_1_1Uid}{Uid}}\ *uid\ \ \ }
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01396\ \ \ \ \ \mbox{\hyperlink{classMFRC522_structMFRC522_1_1MIFARE__Key}{MIFARE\_Key}}\ key;}
\DoxyCodeLine{01397\ \ \ \ \ }
\DoxyCodeLine{01398\ \ \ \ \ \textcolor{comment}{//\ Dump\ UID,\ SAK\ and\ Type}}
\DoxyCodeLine{01399\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a3b9a2c6da6505e0ff7b58c37d7aeff37}{PICC\_DumpDetailsToSerial}}(uid);}
\DoxyCodeLine{01400\ \ \ \ \ }
\DoxyCodeLine{01401\ \ \ \ \ \textcolor{comment}{//\ Dump\ contents}}
\DoxyCodeLine{01402\ \ \ \ \ PICC\_Type\ piccType\ =\ \mbox{\hyperlink{classMFRC522_ac80a18228260bdde07dff5d4ac23bb53}{PICC\_GetType}}(uid-\/>sak);}
\DoxyCodeLine{01403\ \ \ \ \ \textcolor{keywordflow}{switch}\ (piccType)\ \{}
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_MINI:}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_1K:}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_4K:}
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ All\ keys\ are\ set\ to\ FFFFFFFFFFFFh\ at\ chip\ delivery\ from\ the\ factory.}}
\DoxyCodeLine{01408\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ i\ =\ 0;\ i\ <\ 6;\ i++)\ \{}
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key.keyByte[i]\ =\ 0xFF;}
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01411\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_aafba2e74124efa2d736c1672ea104190}{PICC\_DumpMifareClassicToSerial}}(uid,\ piccType,\ \&key);}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01414\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_UL:}
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_ac148d28877dd577606a28e9e7e4b6809}{PICC\_DumpMifareUltralightToSerial}}();}
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01417\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_ISO\_14443\_4:}
\DoxyCodeLine{01419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_DESFIRE:}
\DoxyCodeLine{01420\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_ISO\_18092:}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_PLUS:}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_TNP3XXX:}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Dumping\ memory\ contents\ not\ implemented\ for\ that\ PICC\ type."{}}));}
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_UNKNOWN:}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_NOT\_COMPLETE:}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ No\ memory\ dump\ here}}
\DoxyCodeLine{01430\ \ \ \ \ \}}
\DoxyCodeLine{01431\ \ \ \ \ }
\DoxyCodeLine{01432\ \ \ \ \ Serial.println();}
\DoxyCodeLine{01433\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a8874921b4ed26c5b73d89c90f76d4933}{PICC\_HaltA}}();\ \textcolor{comment}{//\ Already\ done\ if\ it\ was\ a\ MIFARE\ Classic\ PICC.}}
\DoxyCodeLine{01434\ \}\ \textcolor{comment}{//\ End\ PICC\_DumpToSerial()}}
\DoxyCodeLine{01435\ }
\DoxyCodeLine{01439\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a3b9a2c6da6505e0ff7b58c37d7aeff37}{MFRC522::PICC\_DumpDetailsToSerial}}(\mbox{\hyperlink{classMFRC522_structMFRC522_1_1Uid}{Uid}}\ *uid\ }
\DoxyCodeLine{01440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01441\ \ \ \ \ \textcolor{comment}{//\ UID}}
\DoxyCodeLine{01442\ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}Card\ UID:"{}}));}
\DoxyCodeLine{01443\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ i\ =\ 0;\ i\ <\ uid-\/>size;\ i++)\ \{}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(uid-\/>uidByte[i]\ <\ 0x10)}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ 0"{}}));}
\DoxyCodeLine{01446\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ "{}}));}
\DoxyCodeLine{01448\ \ \ \ \ \ \ \ \ Serial.print(uid-\/>uidByte[i],\ HEX);}
\DoxyCodeLine{01449\ \ \ \ \ \}\ }
\DoxyCodeLine{01450\ \ \ \ \ Serial.println();}
\DoxyCodeLine{01451\ \ \ \ \ }
\DoxyCodeLine{01452\ \ \ \ \ \textcolor{comment}{//\ SAK}}
\DoxyCodeLine{01453\ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}Card\ SAK:\ "{}}));}
\DoxyCodeLine{01454\ \ \ \ \ \textcolor{keywordflow}{if}(uid-\/>sak\ <\ 0x10)}
\DoxyCodeLine{01455\ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}0"{}}));}
\DoxyCodeLine{01456\ \ \ \ \ Serial.println(uid-\/>sak,\ HEX);}
\DoxyCodeLine{01457\ \ \ \ \ }
\DoxyCodeLine{01458\ \ \ \ \ \textcolor{comment}{//\ (suggested)\ PICC\ type}}
\DoxyCodeLine{01459\ \ \ \ \ PICC\_Type\ piccType\ =\ \mbox{\hyperlink{classMFRC522_ac80a18228260bdde07dff5d4ac23bb53}{PICC\_GetType}}(uid-\/>sak);}
\DoxyCodeLine{01460\ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}PICC\ type:\ "{}}));}
\DoxyCodeLine{01461\ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_aae4a482352d4d4b7d7a9714b0b0b7c38}{PICC\_GetTypeName}}(piccType));}
\DoxyCodeLine{01462\ \}\ \textcolor{comment}{//\ End\ PICC\_DumpDetailsToSerial()}}
\DoxyCodeLine{01463\ }
\DoxyCodeLine{01468\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_aafba2e74124efa2d736c1672ea104190}{MFRC522::PICC\_DumpMifareClassicToSerial}}(\ \ \ \ \mbox{\hyperlink{classMFRC522_structMFRC522_1_1Uid}{Uid}}\ *uid,\ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PICC\_Type\ piccType,\ }
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_structMFRC522_1_1MIFARE__Key}{MIFARE\_Key}}\ *key\ \ \ \ \ \ \ }
\DoxyCodeLine{01471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01472\ \ \ \ \ \textcolor{keywordtype}{byte}\ no\_of\_sectors\ =\ 0;}
\DoxyCodeLine{01473\ \ \ \ \ \textcolor{keywordflow}{switch}\ (piccType)\ \{}
\DoxyCodeLine{01474\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_MINI:}
\DoxyCodeLine{01475\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Has\ 5\ sectors\ *\ 4\ blocks/sector\ *\ 16\ bytes/block\ =\ 320\ bytes.}}
\DoxyCodeLine{01476\ \ \ \ \ \ \ \ \ \ \ \ \ no\_of\_sectors\ =\ 5;}
\DoxyCodeLine{01477\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01478\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01479\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_1K:}
\DoxyCodeLine{01480\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Has\ 16\ sectors\ *\ 4\ blocks/sector\ *\ 16\ bytes/block\ =\ 1024\ bytes.}}
\DoxyCodeLine{01481\ \ \ \ \ \ \ \ \ \ \ \ \ no\_of\_sectors\ =\ 16;}
\DoxyCodeLine{01482\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01483\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01484\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PICC\_TYPE\_MIFARE\_4K:}
\DoxyCodeLine{01485\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Has\ (32\ sectors\ *\ 4\ blocks/sector\ +\ 8\ sectors\ *\ 16\ blocks/sector)\ *\ 16\ bytes/block\ =\ 4096\ bytes.}}
\DoxyCodeLine{01486\ \ \ \ \ \ \ \ \ \ \ \ \ no\_of\_sectors\ =\ 40;}
\DoxyCodeLine{01487\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01488\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \textcolor{comment}{//\ Should\ not\ happen.\ Ignore.}}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01491\ \ \ \ \ \}}
\DoxyCodeLine{01492\ \ \ \ \ }
\DoxyCodeLine{01493\ \ \ \ \ \textcolor{comment}{//\ Dump\ sectors,\ highest\ address\ first.}}
\DoxyCodeLine{01494\ \ \ \ \ \textcolor{keywordflow}{if}\ (no\_of\_sectors)\ \{}
\DoxyCodeLine{01495\ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Sector\ Block\ \ \ 0\ \ 1\ \ 2\ \ 3\ \ \ 4\ \ 5\ \ 6\ \ 7\ \ \ 8\ \ 9\ 10\ 11\ \ 12\ 13\ 14\ 15\ \ AccessBits"{}}));}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (int8\_t\ i\ =\ no\_of\_sectors\ -\/\ 1;\ i\ >=\ 0;\ i-\/-\/)\ \{}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_a20c559f09927a7c5f91295f6158e4342}{PICC\_DumpMifareClassicSectorToSerial}}(uid,\ key,\ i);}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01499\ \ \ \ \ \}}
\DoxyCodeLine{01500\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a8874921b4ed26c5b73d89c90f76d4933}{PICC\_HaltA}}();\ \textcolor{comment}{//\ Halt\ the\ PICC\ before\ stopping\ the\ encrypted\ session.}}
\DoxyCodeLine{01501\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a24d3ab7b2170fdfa3f0121a7256f12d9}{PCD\_StopCrypto1}}();}
\DoxyCodeLine{01502\ \}\ \textcolor{comment}{//\ End\ PICC\_DumpMifareClassicToSerial()}}
\DoxyCodeLine{01503\ }
\DoxyCodeLine{01509\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_a20c559f09927a7c5f91295f6158e4342}{MFRC522::PICC\_DumpMifareClassicSectorToSerial}}(\mbox{\hyperlink{classMFRC522_structMFRC522_1_1Uid}{Uid}}\ *uid,\ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMFRC522_structMFRC522_1_1MIFARE__Key}{MIFARE\_Key}}\ *key,\ \ }
\DoxyCodeLine{01511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ sector\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01513\ \ \ \ \ MFRC522::StatusCode\ status;}
\DoxyCodeLine{01514\ \ \ \ \ \textcolor{keywordtype}{byte}\ firstBlock;\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Address\ of\ lowest\ address\ to\ dump\ actually\ last\ block\ dumped)}}
\DoxyCodeLine{01515\ \ \ \ \ \textcolor{keywordtype}{byte}\ no\_of\_blocks;\ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ blocks\ in\ sector}}
\DoxyCodeLine{01516\ \ \ \ \ \textcolor{keywordtype}{bool}\ isSectorTrailer;\ \ \ \textcolor{comment}{//\ Set\ to\ true\ while\ handling\ the\ "{}last"{}\ (ie\ highest\ address)\ in\ the\ sector.}}
\DoxyCodeLine{01517\ \ \ \ \ }
\DoxyCodeLine{01518\ \ \ \ \ \textcolor{comment}{//\ The\ access\ bits\ are\ stored\ in\ a\ peculiar\ fashion.}}
\DoxyCodeLine{01519\ \ \ \ \ \textcolor{comment}{//\ There\ are\ four\ groups:}}
\DoxyCodeLine{01520\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ g[3]\ \ \ \ Access\ bits\ for\ the\ sector\ trailer,\ block\ 3\ (for\ sectors\ 0-\/31)\ or\ block\ 15\ (for\ sectors\ 32-\/39)}}
\DoxyCodeLine{01521\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ g[2]\ \ \ \ Access\ bits\ for\ block\ 2\ (for\ sectors\ 0-\/31)\ or\ blocks\ 10-\/14\ (for\ sectors\ 32-\/39)}}
\DoxyCodeLine{01522\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ g[1]\ \ \ \ Access\ bits\ for\ block\ 1\ (for\ sectors\ 0-\/31)\ or\ blocks\ 5-\/9\ (for\ sectors\ 32-\/39)}}
\DoxyCodeLine{01523\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ g[0]\ \ \ \ Access\ bits\ for\ block\ 0\ (for\ sectors\ 0-\/31)\ or\ blocks\ 0-\/4\ (for\ sectors\ 32-\/39)}}
\DoxyCodeLine{01524\ \ \ \ \ \textcolor{comment}{//\ Each\ group\ has\ access\ bits\ [C1\ C2\ C3].\ In\ this\ code\ C1\ is\ MSB\ and\ C3\ is\ LSB.}}
\DoxyCodeLine{01525\ \ \ \ \ \textcolor{comment}{//\ The\ four\ CX\ bits\ are\ stored\ together\ in\ a\ nible\ cx\ and\ an\ inverted\ nible\ cx\_.}}
\DoxyCodeLine{01526\ \ \ \ \ \textcolor{keywordtype}{byte}\ c1,\ c2,\ c3;\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nibbles}}
\DoxyCodeLine{01527\ \ \ \ \ \textcolor{keywordtype}{byte}\ c1\_,\ c2\_,\ c3\_;\ \ \ \ \ \textcolor{comment}{//\ Inverted\ nibbles}}
\DoxyCodeLine{01528\ \ \ \ \ \textcolor{keywordtype}{bool}\ invertedError;\ \ \ \ \ \textcolor{comment}{//\ True\ if\ one\ of\ the\ inverted\ nibbles\ did\ not\ match}}
\DoxyCodeLine{01529\ \ \ \ \ \textcolor{keywordtype}{byte}\ g[4];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Access\ bits\ for\ each\ of\ the\ four\ groups.}}
\DoxyCodeLine{01530\ \ \ \ \ \textcolor{keywordtype}{byte}\ group;\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0-\/3\ -\/\ active\ group\ for\ access\ bits}}
\DoxyCodeLine{01531\ \ \ \ \ \textcolor{keywordtype}{bool}\ firstInGroup;\ \ \ \ \ \ \textcolor{comment}{//\ True\ for\ the\ first\ block\ dumped\ in\ the\ group}}
\DoxyCodeLine{01532\ \ \ \ \ }
\DoxyCodeLine{01533\ \ \ \ \ \textcolor{comment}{//\ Determine\ position\ and\ size\ of\ sector.}}
\DoxyCodeLine{01534\ \ \ \ \ \textcolor{keywordflow}{if}\ (sector\ <\ 32)\ \{\ \textcolor{comment}{//\ Sectors\ 0..31\ has\ 4\ blocks\ each}}
\DoxyCodeLine{01535\ \ \ \ \ \ \ \ \ no\_of\_blocks\ =\ 4;}
\DoxyCodeLine{01536\ \ \ \ \ \ \ \ \ firstBlock\ =\ sector\ *\ no\_of\_blocks;}
\DoxyCodeLine{01537\ \ \ \ \ \}}
\DoxyCodeLine{01538\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (sector\ <\ 40)\ \{\ \textcolor{comment}{//\ Sectors\ 32-\/39\ has\ 16\ blocks\ each}}
\DoxyCodeLine{01539\ \ \ \ \ \ \ \ \ no\_of\_blocks\ =\ 16;}
\DoxyCodeLine{01540\ \ \ \ \ \ \ \ \ firstBlock\ =\ 128\ +\ (sector\ -\/\ 32)\ *\ no\_of\_blocks;}
\DoxyCodeLine{01541\ \ \ \ \ \}}
\DoxyCodeLine{01542\ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ Illegal\ input,\ no\ MIFARE\ Classic\ PICC\ has\ more\ than\ 40\ sectors.}}
\DoxyCodeLine{01543\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01544\ \ \ \ \ \}}
\DoxyCodeLine{01545\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01546\ \ \ \ \ \textcolor{comment}{//\ Dump\ blocks,\ highest\ address\ first.}}
\DoxyCodeLine{01547\ \ \ \ \ \textcolor{keywordtype}{byte}\ byteCount;}
\DoxyCodeLine{01548\ \ \ \ \ \textcolor{keywordtype}{byte}\ buffer[18];}
\DoxyCodeLine{01549\ \ \ \ \ \textcolor{keywordtype}{byte}\ blockAddr;}
\DoxyCodeLine{01550\ \ \ \ \ isSectorTrailer\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01551\ \ \ \ \ invertedError\ =\ \textcolor{keyword}{false};\ \ \textcolor{comment}{//\ Avoid\ "{}unused\ variable"{}\ warning.}}
\DoxyCodeLine{01552\ \ \ \ \ \textcolor{keywordflow}{for}\ (int8\_t\ blockOffset\ =\ no\_of\_blocks\ -\/\ 1;\ blockOffset\ >=\ 0;\ blockOffset-\/-\/)\ \{}
\DoxyCodeLine{01553\ \ \ \ \ \ \ \ \ blockAddr\ =\ firstBlock\ +\ blockOffset;}
\DoxyCodeLine{01554\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sector\ number\ -\/\ only\ on\ first\ line}}
\DoxyCodeLine{01555\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isSectorTrailer)\ \{}
\DoxyCodeLine{01556\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(sector\ <\ 10)}
\DoxyCodeLine{01557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ \ "{}}));\ \textcolor{comment}{//\ Pad\ with\ spaces}}
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ "{}}));\ \textcolor{comment}{//\ Pad\ with\ spaces}}
\DoxyCodeLine{01560\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(sector);}
\DoxyCodeLine{01561\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ \ "{}}));}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01564\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ \ \ \ \ \ "{}}));}
\DoxyCodeLine{01565\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01566\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Block\ number}}
\DoxyCodeLine{01567\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(blockAddr\ <\ 10)}
\DoxyCodeLine{01568\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ \ "{}}));\ \textcolor{comment}{//\ Pad\ with\ spaces}}
\DoxyCodeLine{01569\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01570\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(blockAddr\ <\ 100)}
\DoxyCodeLine{01571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ "{}}));\ \textcolor{comment}{//\ Pad\ with\ spaces}}
\DoxyCodeLine{01572\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ "{}}));\ \textcolor{comment}{//\ Pad\ with\ spaces}}
\DoxyCodeLine{01574\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01575\ \ \ \ \ \ \ \ \ Serial.print(blockAddr);}
\DoxyCodeLine{01576\ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ "{}}));}
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Establish\ encrypted\ communications\ before\ reading\ the\ first\ block}}
\DoxyCodeLine{01578\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isSectorTrailer)\ \{}
\DoxyCodeLine{01579\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_a6c2313c4aa98806cc2bf0e9cca993ec0}{PCD\_Authenticate}}(PICC\_CMD\_MF\_AUTH\_KEY\_A,\ firstBlock,\ key,\ uid);}
\DoxyCodeLine{01580\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}PCD\_Authenticate()\ failed:\ "{}}));}
\DoxyCodeLine{01582\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01584\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01586\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ block}}
\DoxyCodeLine{01587\ \ \ \ \ \ \ \ \ byteCount\ =\ \textcolor{keyword}{sizeof}(buffer);}
\DoxyCodeLine{01588\ \ \ \ \ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_a6ed93e88913ea104420f3bb4a88cce52}{MIFARE\_Read}}(blockAddr,\ buffer,\ \&byteCount);}
\DoxyCodeLine{01589\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01590\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}MIFARE\_Read()\ failed:\ "{}}));}
\DoxyCodeLine{01591\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01592\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01593\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01594\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Dump\ data}}
\DoxyCodeLine{01595\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ index\ =\ 0;\ index\ <\ 16;\ index++)\ \{}
\DoxyCodeLine{01596\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(buffer[index]\ <\ 0x10)}
\DoxyCodeLine{01597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ 0"{}}));}
\DoxyCodeLine{01598\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ "{}}));}
\DoxyCodeLine{01600\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(buffer[index],\ HEX);}
\DoxyCodeLine{01601\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((index\ \%\ 4)\ ==\ 3)\ \{}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ "{}}));}
\DoxyCodeLine{01603\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01604\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01605\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parse\ sector\ trailer\ data}}
\DoxyCodeLine{01606\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isSectorTrailer)\ \{}
\DoxyCodeLine{01607\ \ \ \ \ \ \ \ \ \ \ \ \ c1\ \ =\ buffer[7]\ >>\ 4;}
\DoxyCodeLine{01608\ \ \ \ \ \ \ \ \ \ \ \ \ c2\ \ =\ buffer[8]\ \&\ 0xF;}
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ \ \ \ \ c3\ \ =\ buffer[8]\ >>\ 4;}
\DoxyCodeLine{01610\ \ \ \ \ \ \ \ \ \ \ \ \ c1\_\ =\ buffer[6]\ \&\ 0xF;}
\DoxyCodeLine{01611\ \ \ \ \ \ \ \ \ \ \ \ \ c2\_\ =\ buffer[6]\ >>\ 4;}
\DoxyCodeLine{01612\ \ \ \ \ \ \ \ \ \ \ \ \ c3\_\ =\ buffer[7]\ \&\ 0xF;}
\DoxyCodeLine{01613\ \ \ \ \ \ \ \ \ \ \ \ \ invertedError\ =\ (c1\ !=\ (\string~c1\_\ \&\ 0xF))\ ||\ (c2\ !=\ (\string~c2\_\ \&\ 0xF))\ ||\ (c3\ !=\ (\string~c3\_\ \&\ 0xF));}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ \ \ \ \ g[0]\ =\ ((c1\ \&\ 1)\ <<\ 2)\ |\ ((c2\ \&\ 1)\ <<\ 1)\ |\ ((c3\ \&\ 1)\ <<\ 0);}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \ \ \ \ g[1]\ =\ ((c1\ \&\ 2)\ <<\ 1)\ |\ ((c2\ \&\ 2)\ <<\ 0)\ |\ ((c3\ \&\ 2)\ >>\ 1);}
\DoxyCodeLine{01616\ \ \ \ \ \ \ \ \ \ \ \ \ g[2]\ =\ ((c1\ \&\ 4)\ <<\ 0)\ |\ ((c2\ \&\ 4)\ >>\ 1)\ |\ ((c3\ \&\ 4)\ >>\ 2);}
\DoxyCodeLine{01617\ \ \ \ \ \ \ \ \ \ \ \ \ g[3]\ =\ ((c1\ \&\ 8)\ >>\ 1)\ |\ ((c2\ \&\ 8)\ >>\ 2)\ |\ ((c3\ \&\ 8)\ >>\ 3);}
\DoxyCodeLine{01618\ \ \ \ \ \ \ \ \ \ \ \ \ isSectorTrailer\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01619\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01620\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01621\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Which\ access\ group\ is\ this\ block\ in?}}
\DoxyCodeLine{01622\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (no\_of\_blocks\ ==\ 4)\ \{}
\DoxyCodeLine{01623\ \ \ \ \ \ \ \ \ \ \ \ \ group\ =\ blockOffset;}
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \ \ \ \ firstInGroup\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01625\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01626\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01627\ \ \ \ \ \ \ \ \ \ \ \ \ group\ =\ blockOffset\ /\ 5;}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \ \ \ \ \ \ firstInGroup\ =\ (group\ ==\ 3)\ ||\ (group\ !=\ (blockOffset\ +\ 1)\ /\ 5);}
\DoxyCodeLine{01629\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01630\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01631\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (firstInGroup)\ \{}
\DoxyCodeLine{01632\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ access\ bits}}
\DoxyCodeLine{01633\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ [\ "{}}));}
\DoxyCodeLine{01634\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print((g[group]\ >>\ 2)\ \&\ 1,\ DEC);\ Serial.print(F(\textcolor{stringliteral}{"{}\ "{}}));}
\DoxyCodeLine{01635\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print((g[group]\ >>\ 1)\ \&\ 1,\ DEC);\ Serial.print(F(\textcolor{stringliteral}{"{}\ "{}}));}
\DoxyCodeLine{01636\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print((g[group]\ >>\ 0)\ \&\ 1,\ DEC);}
\DoxyCodeLine{01637\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ ]\ "{}}));}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (invertedError)\ \{}
\DoxyCodeLine{01639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ Inverted\ access\ bits\ did\ not\ match!\ "{}}));}
\DoxyCodeLine{01640\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (group\ !=\ 3\ \&\&\ (g[group]\ ==\ 1\ ||\ g[group]\ ==\ 6))\ \{\ \textcolor{comment}{//\ Not\ a\ sector\ trailer,\ a\ value\ block}}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ value\ =\ (int32\_t(buffer[3])<<24)\ |\ (int32\_t(buffer[2])<<16)\ |\ (int32\_t(buffer[1])<<8)\ |\ int32\_t(buffer[0]);}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ Value=0x"{}}));\ Serial.print(value,\ HEX);}
\DoxyCodeLine{01646\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ Adr=0x"{}}));\ Serial.print(buffer[12],\ HEX);}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01648\ \ \ \ \ \ \ \ \ Serial.println();}
\DoxyCodeLine{01649\ \ \ \ \ \}}
\DoxyCodeLine{01650\ \ \ \ \ }
\DoxyCodeLine{01651\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01652\ \}\ \textcolor{comment}{//\ End\ PICC\_DumpMifareClassicSectorToSerial()}}
\DoxyCodeLine{01653\ }
\DoxyCodeLine{01657\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_ac148d28877dd577606a28e9e7e4b6809}{MFRC522::PICC\_DumpMifareUltralightToSerial}}()\ \{}
\DoxyCodeLine{01658\ \ \ \ \ MFRC522::StatusCode\ status;}
\DoxyCodeLine{01659\ \ \ \ \ \textcolor{keywordtype}{byte}\ byteCount;}
\DoxyCodeLine{01660\ \ \ \ \ \textcolor{keywordtype}{byte}\ buffer[18];}
\DoxyCodeLine{01661\ \ \ \ \ \textcolor{keywordtype}{byte}\ i;}
\DoxyCodeLine{01662\ \ \ \ \ }
\DoxyCodeLine{01663\ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Page\ \ 0\ \ 1\ \ 2\ \ 3"{}}));}
\DoxyCodeLine{01664\ \ \ \ \ \textcolor{comment}{//\ Try\ the\ mpages\ of\ the\ original\ Ultralight.\ Ultralight\ C\ has\ more\ pages.}}
\DoxyCodeLine{01665\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ page\ =\ 0;\ page\ <\ 16;\ page\ +=4)\ \{\ \textcolor{comment}{//\ Read\ returns\ data\ for\ 4\ pages\ at\ a\ time.}}
\DoxyCodeLine{01666\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ pages}}
\DoxyCodeLine{01667\ \ \ \ \ \ \ \ \ byteCount\ =\ \textcolor{keyword}{sizeof}(buffer);}
\DoxyCodeLine{01668\ \ \ \ \ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_a6ed93e88913ea104420f3bb4a88cce52}{MIFARE\_Read}}(page,\ buffer,\ \&byteCount);}
\DoxyCodeLine{01669\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01670\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}MIFARE\_Read()\ failed:\ "{}}));}
\DoxyCodeLine{01671\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01672\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01673\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01674\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Dump\ data}}
\DoxyCodeLine{01675\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ offset\ =\ 0;\ offset\ <\ 4;\ offset++)\ \{}
\DoxyCodeLine{01676\ \ \ \ \ \ \ \ \ \ \ \ \ i\ =\ page\ +\ offset;}
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(i\ <\ 10)}
\DoxyCodeLine{01678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ "{}}));\ \textcolor{comment}{//\ Pad\ with\ spaces}}
\DoxyCodeLine{01679\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ "{}}));\ \textcolor{comment}{//\ Pad\ with\ spaces}}
\DoxyCodeLine{01681\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(i);}
\DoxyCodeLine{01682\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ \ "{}}));}
\DoxyCodeLine{01683\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ index\ =\ 0;\ index\ <\ 4;\ index++)\ \{}
\DoxyCodeLine{01684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\ =\ 4\ *\ offset\ +\ index;}
\DoxyCodeLine{01685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(buffer[i]\ <\ 0x10)}
\DoxyCodeLine{01686\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ 0"{}}));}
\DoxyCodeLine{01687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ "{}}));}
\DoxyCodeLine{01689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(buffer[i],\ HEX);}
\DoxyCodeLine{01690\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01691\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println();}
\DoxyCodeLine{01692\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01693\ \ \ \ \ \}}
\DoxyCodeLine{01694\ \}\ \textcolor{comment}{//\ End\ PICC\_DumpMifareUltralightToSerial()}}
\DoxyCodeLine{01695\ }
\DoxyCodeLine{01699\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMFRC522_ab8c712963189654e9bc368be8783e2ab}{MFRC522::MIFARE\_SetAccessBits}}(\ \ \ \ \textcolor{keywordtype}{byte}\ *accessBitBuffer,\ \ }
\DoxyCodeLine{01700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ g0,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ g1,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ g2,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ g3\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{01705\ \ \ \ \ \textcolor{keywordtype}{byte}\ c1\ =\ ((g3\ \&\ 4)\ <<\ 1)\ |\ ((g2\ \&\ 4)\ <<\ 0)\ |\ ((g1\ \&\ 4)\ >>\ 1)\ |\ ((g0\ \&\ 4)\ >>\ 2);}
\DoxyCodeLine{01706\ \ \ \ \ \textcolor{keywordtype}{byte}\ c2\ =\ ((g3\ \&\ 2)\ <<\ 2)\ |\ ((g2\ \&\ 2)\ <<\ 1)\ |\ ((g1\ \&\ 2)\ <<\ 0)\ |\ ((g0\ \&\ 2)\ >>\ 1);}
\DoxyCodeLine{01707\ \ \ \ \ \textcolor{keywordtype}{byte}\ c3\ =\ ((g3\ \&\ 1)\ <<\ 3)\ |\ ((g2\ \&\ 1)\ <<\ 2)\ |\ ((g1\ \&\ 1)\ <<\ 1)\ |\ ((g0\ \&\ 1)\ <<\ 0);}
\DoxyCodeLine{01708\ \ \ \ \ }
\DoxyCodeLine{01709\ \ \ \ \ accessBitBuffer[0]\ =\ (\string~c2\ \&\ 0xF)\ <<\ 4\ |\ (\string~c1\ \&\ 0xF);}
\DoxyCodeLine{01710\ \ \ \ \ accessBitBuffer[1]\ =\ \ \ \ \ \ \ \ \ \ c1\ <<\ 4\ |\ (\string~c3\ \&\ 0xF);}
\DoxyCodeLine{01711\ \ \ \ \ accessBitBuffer[2]\ =\ \ \ \ \ \ \ \ \ \ c3\ <<\ 4\ |\ c2;}
\DoxyCodeLine{01712\ \}\ \textcolor{comment}{//\ End\ MIFARE\_SetAccessBits()}}
\DoxyCodeLine{01713\ }
\DoxyCodeLine{01714\ }
\DoxyCodeLine{01726\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMFRC522_a925607adc9382720c222578bd236a9c8}{MFRC522::MIFARE\_OpenUidBackdoor}}(\textcolor{keywordtype}{bool}\ logErrors)\ \{}
\DoxyCodeLine{01727\ \ \ \ \ \textcolor{comment}{//\ Magic\ sequence:}}
\DoxyCodeLine{01728\ \ \ \ \ \textcolor{comment}{//\ >\ 50\ 00\ 57\ CD\ (HALT\ +\ CRC)}}
\DoxyCodeLine{01729\ \ \ \ \ \textcolor{comment}{//\ >\ 40\ (7\ bits\ only)}}
\DoxyCodeLine{01730\ \ \ \ \ \textcolor{comment}{//\ <\ A\ (4\ bits\ only)}}
\DoxyCodeLine{01731\ \ \ \ \ \textcolor{comment}{//\ >\ 43}}
\DoxyCodeLine{01732\ \ \ \ \ \textcolor{comment}{//\ <\ A\ (4\ bits\ only)}}
\DoxyCodeLine{01733\ \ \ \ \ \textcolor{comment}{//\ Then\ you\ can\ write\ to\ sector\ 0\ without\ authenticating}}
\DoxyCodeLine{01734\ \ \ \ \ }
\DoxyCodeLine{01735\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a8874921b4ed26c5b73d89c90f76d4933}{PICC\_HaltA}}();\ \textcolor{comment}{//\ 50\ 00\ 57\ CD}}
\DoxyCodeLine{01736\ \ \ \ \ }
\DoxyCodeLine{01737\ \ \ \ \ \textcolor{keywordtype}{byte}\ cmd\ =\ 0x40;}
\DoxyCodeLine{01738\ \ \ \ \ \textcolor{keywordtype}{byte}\ validBits\ =\ 7;\ \textcolor{comment}{/*\ Our\ command\ is\ only\ 7\ bits.\ After\ receiving\ card\ response,}}
\DoxyCodeLine{01739\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ this\ will\ contain\ amount\ of\ valid\ response\ bits.\ */}}
\DoxyCodeLine{01740\ \ \ \ \ \textcolor{keywordtype}{byte}\ response[32];\ \textcolor{comment}{//\ Card's\ response\ is\ written\ here}}
\DoxyCodeLine{01741\ \ \ \ \ \textcolor{keywordtype}{byte}\ received\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{01742\ \ \ \ \ MFRC522::StatusCode\ status\ =\ \mbox{\hyperlink{classMFRC522_aaa96aa7ec4f95e0835cb758ad0450d74}{PCD\_TransceiveData}}(\&cmd,\ (\textcolor{keywordtype}{byte})1,\ response,\ \&received,\ \&validBits,\ (\textcolor{keywordtype}{byte})0,\ \textcolor{keyword}{false});\ \textcolor{comment}{//\ 40}}
\DoxyCodeLine{01743\ \ \ \ \ \textcolor{keywordflow}{if}(status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01744\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(logErrors)\ \{}
\DoxyCodeLine{01745\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Card\ did\ not\ respond\ to\ 0x40\ after\ HALT\ command.\ Are\ you\ sure\ it\ is\ a\ UID\ changeable\ one?"{}}));}
\DoxyCodeLine{01746\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}Error\ name:\ "{}}));}
\DoxyCodeLine{01747\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01748\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01749\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01750\ \ \ \ \ \}}
\DoxyCodeLine{01751\ \ \ \ \ \textcolor{keywordflow}{if}\ (received\ !=\ 1\ ||\ response[0]\ !=\ 0x0A)\ \{}
\DoxyCodeLine{01752\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01753\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}Got\ bad\ response\ on\ backdoor\ 0x40\ command:\ "{}}));}
\DoxyCodeLine{01754\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(response[0],\ HEX);}
\DoxyCodeLine{01755\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ ("{}}));}
\DoxyCodeLine{01756\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(validBits);}
\DoxyCodeLine{01757\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ valid\ bits)\(\backslash\)r\(\backslash\)n"{}}));}
\DoxyCodeLine{01758\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01759\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01760\ \ \ \ \ \}}
\DoxyCodeLine{01761\ \ \ \ \ }
\DoxyCodeLine{01762\ \ \ \ \ cmd\ =\ 0x43;}
\DoxyCodeLine{01763\ \ \ \ \ validBits\ =\ 8;}
\DoxyCodeLine{01764\ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_aaa96aa7ec4f95e0835cb758ad0450d74}{PCD\_TransceiveData}}(\&cmd,\ (\textcolor{keywordtype}{byte})1,\ response,\ \&received,\ \&validBits,\ (\textcolor{keywordtype}{byte})0,\ \textcolor{keyword}{false});\ \textcolor{comment}{//\ 43}}
\DoxyCodeLine{01765\ \ \ \ \ \textcolor{keywordflow}{if}(status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01766\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(logErrors)\ \{}
\DoxyCodeLine{01767\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Error\ in\ communication\ at\ command\ 0x43,\ after\ successfully\ executing\ 0x40"{}}));}
\DoxyCodeLine{01768\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}Error\ name:\ "{}}));}
\DoxyCodeLine{01769\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01770\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01771\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01772\ \ \ \ \ \}}
\DoxyCodeLine{01773\ \ \ \ \ \textcolor{keywordflow}{if}\ (received\ !=\ 1\ ||\ response[0]\ !=\ 0x0A)\ \{}
\DoxyCodeLine{01774\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01775\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}Got\ bad\ response\ on\ backdoor\ 0x43\ command:\ "{}}));}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(response[0],\ HEX);}
\DoxyCodeLine{01777\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ ("{}}));}
\DoxyCodeLine{01778\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(validBits);}
\DoxyCodeLine{01779\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}\ valid\ bits)\(\backslash\)r\(\backslash\)n"{}}));}
\DoxyCodeLine{01780\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01781\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01782\ \ \ \ \ \}}
\DoxyCodeLine{01783\ \ \ \ \ }
\DoxyCodeLine{01784\ \ \ \ \ \textcolor{comment}{//\ You\ can\ now\ write\ to\ sector\ 0\ without\ authenticating!}}
\DoxyCodeLine{01785\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01786\ \}\ \textcolor{comment}{//\ End\ MIFARE\_OpenUidBackdoor()}}
\DoxyCodeLine{01787\ }
\DoxyCodeLine{01796\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMFRC522_a2bdc18af4952ce99099607c84139b51c}{MFRC522::MIFARE\_SetUid}}(\textcolor{keywordtype}{byte}\ *newUid,\ \textcolor{keywordtype}{byte}\ uidSize,\ \textcolor{keywordtype}{bool}\ logErrors)\ \{}
\DoxyCodeLine{01797\ \ \ \ \ }
\DoxyCodeLine{01798\ \ \ \ \ \textcolor{comment}{//\ UID\ +\ BCC\ byte\ can\ not\ be\ larger\ than\ 16\ together}}
\DoxyCodeLine{01799\ \ \ \ \ \textcolor{keywordflow}{if}\ (!newUid\ ||\ !uidSize\ ||\ uidSize\ >\ 15)\ \{}
\DoxyCodeLine{01800\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01801\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}New\ UID\ buffer\ empty,\ size\ 0,\ or\ size\ >\ 15\ given"{}}));}
\DoxyCodeLine{01802\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01803\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01804\ \ \ \ \ \}}
\DoxyCodeLine{01805\ \ \ \ \ }
\DoxyCodeLine{01806\ \ \ \ \ \textcolor{comment}{//\ Authenticate\ for\ reading}}
\DoxyCodeLine{01807\ \ \ \ \ \mbox{\hyperlink{classMFRC522_structMFRC522_1_1MIFARE__Key}{MIFARE\_Key}}\ key\ =\ \{0xFF,\ 0xFF,\ 0xFF,\ 0xFF,\ 0xFF,\ 0xFF\};}
\DoxyCodeLine{01808\ \ \ \ \ MFRC522::StatusCode\ status\ =\ \mbox{\hyperlink{classMFRC522_a6c2313c4aa98806cc2bf0e9cca993ec0}{PCD\_Authenticate}}(MFRC522::PICC\_CMD\_MF\_AUTH\_KEY\_A,\ (\textcolor{keywordtype}{byte})1,\ \&key,\ \&uid);}
\DoxyCodeLine{01809\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01810\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01811\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ ==\ STATUS\_TIMEOUT)\ \{}
\DoxyCodeLine{01812\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ get\ a\ read\ timeout\ if\ no\ card\ is\ selected\ yet,\ so\ let's\ select\ one}}
\DoxyCodeLine{01813\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01814\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wake\ the\ card\ up\ again\ if\ sleeping}}
\DoxyCodeLine{01815\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ byte\ atqa\_answer[2];}}
\DoxyCodeLine{01816\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ byte\ atqa\_size\ =\ 2;}}
\DoxyCodeLine{01817\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ PICC\_WakeupA(atqa\_answer,\ \&atqa\_size);}}
\DoxyCodeLine{01818\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01819\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classMFRC522_a3adca9d3b455c680ebcde3b74c4e567b}{PICC\_IsNewCardPresent}}()\ ||\ !\mbox{\hyperlink{classMFRC522_aab1218c71cec9cc17ee3ac8a683df106}{PICC\_ReadCardSerial}}())\ \{}
\DoxyCodeLine{01820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}No\ card\ was\ previously\ selected,\ and\ none\ are\ available.\ Failed\ to\ set\ UID."{}}));}
\DoxyCodeLine{01821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01822\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01823\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01824\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_a6c2313c4aa98806cc2bf0e9cca993ec0}{PCD\_Authenticate}}(MFRC522::PICC\_CMD\_MF\_AUTH\_KEY\_A,\ (\textcolor{keywordtype}{byte})1,\ \&key,\ \&uid);}
\DoxyCodeLine{01825\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ tried,\ time\ to\ give\ up}}
\DoxyCodeLine{01827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01828\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Failed\ to\ authenticate\ to\ card\ for\ reading,\ could\ not\ set\ UID:\ "{}}));}
\DoxyCodeLine{01829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01831\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01832\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01833\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01834\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01835\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01836\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}PCD\_Authenticate()\ failed:\ "{}}));}
\DoxyCodeLine{01837\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01838\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01839\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01840\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01841\ \ \ \ \ \}}
\DoxyCodeLine{01842\ \ \ \ \ }
\DoxyCodeLine{01843\ \ \ \ \ \textcolor{comment}{//\ Read\ block\ 0}}
\DoxyCodeLine{01844\ \ \ \ \ \textcolor{keywordtype}{byte}\ block0\_buffer[18];}
\DoxyCodeLine{01845\ \ \ \ \ \textcolor{keywordtype}{byte}\ byteCount\ =\ \textcolor{keyword}{sizeof}(block0\_buffer);}
\DoxyCodeLine{01846\ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_a6ed93e88913ea104420f3bb4a88cce52}{MIFARE\_Read}}((\textcolor{keywordtype}{byte})0,\ block0\_buffer,\ \&byteCount);}
\DoxyCodeLine{01847\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01848\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01849\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}MIFARE\_Read()\ failed:\ "{}}));}
\DoxyCodeLine{01850\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01851\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Are\ you\ sure\ your\ KEY\ A\ for\ sector\ 0\ is\ 0xFFFFFFFFFFFF?"{}}));}
\DoxyCodeLine{01852\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01853\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01854\ \ \ \ \ \}}
\DoxyCodeLine{01855\ \ \ \ \ }
\DoxyCodeLine{01856\ \ \ \ \ \textcolor{comment}{//\ Write\ new\ UID\ to\ the\ data\ we\ just\ read,\ and\ calculate\ BCC\ byte}}
\DoxyCodeLine{01857\ \ \ \ \ \textcolor{keywordtype}{byte}\ bcc\ =\ 0;}
\DoxyCodeLine{01858\ \ \ \ \ \textcolor{keywordflow}{for}\ (uint8\_t\ i\ =\ 0;\ i\ <\ uidSize;\ i++)\ \{}
\DoxyCodeLine{01859\ \ \ \ \ \ \ \ \ block0\_buffer[i]\ =\ newUid[i];}
\DoxyCodeLine{01860\ \ \ \ \ \ \ \ \ bcc\ \string^=\ newUid[i];}
\DoxyCodeLine{01861\ \ \ \ \ \}}
\DoxyCodeLine{01862\ \ \ \ \ }
\DoxyCodeLine{01863\ \ \ \ \ \textcolor{comment}{//\ Write\ BCC\ byte\ to\ buffer}}
\DoxyCodeLine{01864\ \ \ \ \ block0\_buffer[uidSize]\ =\ bcc;}
\DoxyCodeLine{01865\ \ \ \ \ }
\DoxyCodeLine{01866\ \ \ \ \ \textcolor{comment}{//\ Stop\ encrypted\ traffic\ so\ we\ can\ send\ raw\ bytes}}
\DoxyCodeLine{01867\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a24d3ab7b2170fdfa3f0121a7256f12d9}{PCD\_StopCrypto1}}();}
\DoxyCodeLine{01868\ \ \ \ \ }
\DoxyCodeLine{01869\ \ \ \ \ \textcolor{comment}{//\ Activate\ UID\ backdoor}}
\DoxyCodeLine{01870\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classMFRC522_a925607adc9382720c222578bd236a9c8}{MIFARE\_OpenUidBackdoor}}(logErrors))\ \{}
\DoxyCodeLine{01871\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01872\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Activating\ the\ UID\ backdoor\ failed."{}}));}
\DoxyCodeLine{01873\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01874\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01875\ \ \ \ \ \}}
\DoxyCodeLine{01876\ \ \ \ \ }
\DoxyCodeLine{01877\ \ \ \ \ \textcolor{comment}{//\ Write\ modified\ block\ 0\ back\ to\ card}}
\DoxyCodeLine{01878\ \ \ \ \ status\ =\ \mbox{\hyperlink{classMFRC522_a0dc5fb05769779ec3ed708bd153706b3}{MIFARE\_Write}}((\textcolor{keywordtype}{byte})0,\ block0\_buffer,\ (\textcolor{keywordtype}{byte})16);}
\DoxyCodeLine{01879\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01880\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01881\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}MIFARE\_Write()\ failed:\ "{}}));}
\DoxyCodeLine{01882\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01883\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01884\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01885\ \ \ \ \ \}}
\DoxyCodeLine{01886\ \ \ \ \ }
\DoxyCodeLine{01887\ \ \ \ \ \textcolor{comment}{//\ Wake\ the\ card\ up\ again}}
\DoxyCodeLine{01888\ \ \ \ \ \textcolor{keywordtype}{byte}\ atqa\_answer[2];}
\DoxyCodeLine{01889\ \ \ \ \ \textcolor{keywordtype}{byte}\ atqa\_size\ =\ 2;}
\DoxyCodeLine{01890\ \ \ \ \ \mbox{\hyperlink{classMFRC522_ad00a1efcfa6dc203ca885d43f4d02125}{PICC\_WakeupA}}(atqa\_answer,\ \&atqa\_size);}
\DoxyCodeLine{01891\ \ \ \ \ }
\DoxyCodeLine{01892\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01893\ \}}
\DoxyCodeLine{01894\ }
\DoxyCodeLine{01898\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMFRC522_afcbb15d925cb3bea9f58595111fbca48}{MFRC522::MIFARE\_UnbrickUidSector}}(\textcolor{keywordtype}{bool}\ logErrors)\ \{}
\DoxyCodeLine{01899\ \ \ \ \ \mbox{\hyperlink{classMFRC522_a925607adc9382720c222578bd236a9c8}{MIFARE\_OpenUidBackdoor}}(logErrors);}
\DoxyCodeLine{01900\ \ \ \ \ }
\DoxyCodeLine{01901\ \ \ \ \ \textcolor{keywordtype}{byte}\ block0\_buffer[]\ =\ \{0x01,\ 0x02,\ 0x03,\ 0x04,\ 0x04,\ 0x08,\ 0x04,\ 0x00,\ 0x00,\ 0x00,\ 0x00,\ 0x00,\ 0x00,\ 0x00,\ 0x00,\ 0x00\};\ \ \ \ }
\DoxyCodeLine{01902\ \ \ \ \ }
\DoxyCodeLine{01903\ \ \ \ \ \textcolor{comment}{//\ Write\ modified\ block\ 0\ back\ to\ card}}
\DoxyCodeLine{01904\ \ \ \ \ MFRC522::StatusCode\ status\ =\ \mbox{\hyperlink{classMFRC522_a0dc5fb05769779ec3ed708bd153706b3}{MIFARE\_Write}}((\textcolor{keywordtype}{byte})0,\ block0\_buffer,\ (\textcolor{keywordtype}{byte})16);}
\DoxyCodeLine{01905\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ STATUS\_OK)\ \{}
\DoxyCodeLine{01906\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logErrors)\ \{}
\DoxyCodeLine{01907\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.print(F(\textcolor{stringliteral}{"{}MIFARE\_Write()\ failed:\ "{}}));}
\DoxyCodeLine{01908\ \ \ \ \ \ \ \ \ \ \ \ \ Serial.println(\mbox{\hyperlink{classMFRC522_a32f88620ab97f7fef3693280c58cb4bb}{GetStatusCodeName}}(status));}
\DoxyCodeLine{01909\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01910\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01911\ \ \ \ \ \}}
\DoxyCodeLine{01912\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01913\ \}}
\DoxyCodeLine{01914\ }
\DoxyCodeLine{01916\ \textcolor{comment}{//\ Convenience\ functions\ -\/\ does\ not\ add\ extra\ functionality}}
\DoxyCodeLine{01918\ }
\DoxyCodeLine{01925\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMFRC522_a3adca9d3b455c680ebcde3b74c4e567b}{MFRC522::PICC\_IsNewCardPresent}}()\ \{}
\DoxyCodeLine{01926\ \ \ \ \ \textcolor{keywordtype}{byte}\ bufferATQA[2];}
\DoxyCodeLine{01927\ \ \ \ \ \textcolor{keywordtype}{byte}\ bufferSize\ =\ \textcolor{keyword}{sizeof}(bufferATQA);}
\DoxyCodeLine{01928\ }
\DoxyCodeLine{01929\ \ \ \ \ \textcolor{comment}{//\ Reset\ baud\ rates}}
\DoxyCodeLine{01930\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(TxModeReg,\ 0x00);}
\DoxyCodeLine{01931\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(RxModeReg,\ 0x00);}
\DoxyCodeLine{01932\ \ \ \ \ \textcolor{comment}{//\ Reset\ ModWidthReg}}
\DoxyCodeLine{01933\ \ \ \ \ \mbox{\hyperlink{classMFRC522_aa5e5825adb4c784d8a5a60242c135fb7}{PCD\_WriteRegister}}(ModWidthReg,\ 0x26);}
\DoxyCodeLine{01934\ }
\DoxyCodeLine{01935\ \ \ \ \ MFRC522::StatusCode\ result\ =\ \mbox{\hyperlink{classMFRC522_a4e0ac6edf5e8f6ade351b009278fbbc7}{PICC\_RequestA}}(bufferATQA,\ \&bufferSize);}
\DoxyCodeLine{01936\ \ \ \ \ \textcolor{keywordflow}{return}\ (result\ ==\ STATUS\_OK\ ||\ result\ ==\ STATUS\_COLLISION);}
\DoxyCodeLine{01937\ \}\ \textcolor{comment}{//\ End\ PICC\_IsNewCardPresent()}}
\DoxyCodeLine{01938\ }
\DoxyCodeLine{01947\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMFRC522_aab1218c71cec9cc17ee3ac8a683df106}{MFRC522::PICC\_ReadCardSerial}}()\ \{}
\DoxyCodeLine{01948\ \ \ \ \ MFRC522::StatusCode\ result\ =\ \mbox{\hyperlink{classMFRC522_a7a78c629cb4e1d90cc2d7526b17d6c22}{PICC\_Select}}(\&uid);}
\DoxyCodeLine{01949\ \ \ \ \ \textcolor{keywordflow}{return}\ (result\ ==\ STATUS\_OK);}
\DoxyCodeLine{01950\ \}\ \textcolor{comment}{//\ End\ }}

\end{DoxyCode}
